<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamster Wheel of Knowledge: Mini-Bibliography Marathon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            touch-action: none;
        }

        #wheel-spinner {
            transform-origin: center;
            transform-box: fill-box;
        }

        /* --- Hamster & Wheel Animation --- */
        .hamster-container {
            width: 300px;
            height: 300px;
            position: relative;
        }

        #hamster-wheel {
            width: 100%;
            height: 100%;
            transition: transform 0.5s linear;
        }

        #hamster {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -15%); /* Moved hamster down */
            animation-play-state: paused;
        }

        /* Hamster running animation - More dynamic */
        @keyframes run {
            0% { transform: translate(-50%, -15%) rotate(-2deg); }
            25% { transform: translate(-52%, -18%) rotate(0deg); }
            50% { transform: translate(-50%, -15%) rotate(2deg); }
            75% { transform: translate(-48%, -18%) rotate(0deg); }
            100% { transform: translate(-50%, -15%) rotate(-2deg); }
        }
        
        .running #hamster {
            animation: run 0.5s infinite linear;
            animation-play-state: running;
        }
        
        /* Stumble animation for wrong answers - Adjusted for new position */
        @keyframes stumble {
            0% { transform: translate(-50%, -15%) rotate(0deg); }
            25% { transform: translate(-55%, -20%) rotate(-15deg); }
            50% { transform: translate(-50%, -15%) rotate(10deg); }
            75% { transform: translate(-45%, -20%) rotate(15deg); }
            100% { transform: translate(-50%, -15%) rotate(0deg); }
        }

        .stumble #hamster {
            animation: stumble 0.5s ease-in-out;
        }

        /* --- Drag and Drop --- */
        .draggable {
            cursor: grab;
            user-select: none;
        }
        .drop-zone {
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .drop-zone.over {
            background-color: #f0fdf4; /* Tailwind green-50 */
            transform: scale(1.05);
        }
        .drop-zone.correct {
            background-color: #dcfce7; /* Tailwind green-200 */
            border-color: #22c55e; /* Tailwind green-500 */
        }
        .drop-zone.incorrect {
            background-color: #fee2e2; /* Tailwind red-200 */
            border-color: #ef4444; /* Tailwind red-500 */
        }
        
        /* Card flip for feedback */
        .feedback-card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .feedback-card.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .card-back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-sky-100 to-indigo-200 min-h-screen flex items-center justify-center p-4">

    <div id="game-container" class="w-full max-w-4xl mx-auto">

        <!-- Language Selection Screen -->
        <div id="language-screen" class="text-center bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Choose Your Language</h1>
            <p class="text-xl text-slate-600 mb-8">Please select a language to begin.</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button data-lang="en" class="lang-select bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform">
                    English
                </button>
                <button data-lang="zh" class="lang-select bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform">
                    ä¸­æ–‡ (Chinese)
                </button>
                <button data-lang="tr" class="lang-select bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform">
                    TÃ¼rkÃ§e (Turkish)
                </button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="hidden text-center bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
            <h1 id="start-title" class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Hamster Wheel of Knowledge</h1>
            <p id="start-subtitle" class="text-xl text-slate-600 mb-2">Help the hamster complete the "Mini-Bibliography Marathon"!</p>
            <p id="start-instructions" class="text-slate-500 mb-8">Answer citation questions correctly to make the hamster run faster. Wrong answers will make it stumble!</p>
            <button id="start-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg transform hover:scale-105 transition-transform">
                Start the Marathon!
            </button>
        </div>

        <!-- Main Game Screen -->
        <div id="main-game" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                
                <!-- Left Panel: Hamster Animation -->
                <div class="bg-white/50 backdrop-blur-sm p-6 rounded-2xl shadow-md flex flex-col items-center justify-center order-2 md:order-1">
                    <h2 id="main-header" class="text-2xl font-bold text-slate-700 mb-4">Mini-Bibliography Marathon</h2>
                    <div id="animation-container" class="hamster-container">
                        <!-- Hamster Wheel SVG - Updated for better visuals -->
                        <svg id="hamster-wheel" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <!-- Stand - Stays stationary -->
                            <g id="wheel-stand">
                                <path d="M 80 180 L 70 200 H 130 L 120 180 Z" fill="#a0aec0"/>
                                <path d="M 100 100 L 100 180" stroke="#718096" stroke-width="6" stroke-linecap="round"/>
                            </g>
                            
                            <!-- Wheel - Rotates -->
                            <g id="wheel-spinner">
                                <!-- Back rim -->
                                <circle cx="100" cy="100" r="80" fill="none" stroke="#60a5fa" stroke-width="8" opacity="0.7"/>
                                <!-- Spokes -->
                                <g stroke="#93c5fd" stroke-width="2">
                                    <line x1="100" y1="100" x2="100" y2="20" />
                                    <line x1="100" y1="100" x2="157" y2="43" />
                                    <line x1="100" y1="100" x2="180" y2="100" />
                                    <line x1="100" y1="100" x2="157" y2="157" />
                                    <line x1="100" y1="100" x2="100" y2="180" />
                                    <line x1="100" y1="100" x2="43" y2="157" />
                                    <line x1="100" y1="100" x2="20" y2="100" />
                                    <line x1="100" y1="100" x2="43" y2="43" />
                                </g>
                                 <!-- Front rim -->
                                <circle cx="100" cy="100" r="80" fill="none" stroke="#3b82f6" stroke-width="12"/>
                                <!-- Center pin -->
                                <circle cx="100" cy="100" r="10" fill="#2563eb"/>
                                <circle cx="100" cy="100" r="5" fill="#93c5fd"/>
                            </g>
                        </svg>
                        
                        <!-- Hamster SVG - Updated for better visuals -->
                        <svg id="hamster" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <g>
                                <!-- Tail -->
                                <path d="M68,60 Q75,58 73,65" fill="#f6ad55"/>
                                <!-- Back Leg -->
                                <ellipse cx="60" cy="70" rx="10" ry="8" fill="#e5983c"/>
                                <!-- Body -->
                                <path d="M30,50 C10,50 15,80 35,80 C55,80 70,80 70,60 C70,40 50,30 40,35 Z" fill="#f6ad55"/>
                                <!-- Belly -->
                                <path d="M35,78 C40,82 50,82 55,78" fill="#fff7ed" stroke="#fde68a" stroke-width="1"/>
                                <!-- Front Paw -->
                                <ellipse cx="38" cy="72" rx="6" ry="5" fill="#e5983c"/>
                                <!-- Head -->
                                <circle cx="30" cy="45" r="15" fill="#f6ad55"/>
                                <!-- Ear -->
                                <path d="M25,30 Q30,25 35,32" fill="#e5983c"/>
                                <path d="M27,32 Q30,29 33,33" fill="#fed7d7"/>
                                <!-- Eye -->
                                <circle cx="35" cy="43" r="3" fill="#2d3748"/>
                                <!-- Nose -->
                                <circle cx="20" cy="50" r="2" fill="#4a5568"/>
                            </g>
                        </svg>
                    </div>
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-4 mt-4 overflow-hidden">
                        <div id="progress-bar" class="bg-green-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="text-sm text-slate-600 mt-2">0 / 20 Questions</p>
                </div>
                
                <!-- Right Panel: Question -->
                <div class="bg-white/50 backdrop-blur-sm p-6 rounded-2xl shadow-md order-1 md:order-2">
                    <div id="question-area">
                        <!-- Question content will be dynamically inserted here -->
                    </div>
                    <div id="feedback-area" class="mt-4 text-center"></div>
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="hidden text-center bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
             <div id="feedback-card" class="feedback-card w-full">
                <div class="card-face">
                    <h1 id="end-title" class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">Marathon Complete!</h1>
                    <p id="end-message" class="text-xl text-slate-600 mb-6">Great job! You helped the hamster finish the race!</p>
                    <p class="text-2xl font-semibold text-slate-700"><span id="final-score-text">Final Score</span>: <span id="final-score" class="text-indigo-600">0</span></p>
                </div>
                <div class="card-face card-back p-6 border rounded-lg bg-sky-50">
                     <h2 id="summary-title" class="text-2xl font-bold text-slate-700 mb-3">Key Takeaways ğŸ“</h2>
                     <ul id="summary-list" class="text-left text-slate-600 space-y-2">
                        <li><span class="font-semibold">Book Citation:</span> Author, *Title* (in italics), Year.</li>
                        <li><span class="font-semibold">Website Citation:</span> Organization, "Article Title," Year, URL.</li>
                        <li>A bibliography helps give credit to original authors!</li>
                     </ul>
                </div>
            </div>
            <div class="mt-8 flex gap-4 justify-center">
                 <button id="show-summary" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-transform">
                    Show Key Takeaways
                </button>
                <button id="restart-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-transform">
                    Run Again!
                </button>
            </div>
        </div>
    </div>

<script>
    // --- DOM Elements ---
    const languageScreen = document.getElementById('language-screen');
    const startScreen = document.getElementById('start-screen');
    const mainGame = document.getElementById('main-game');
    const endScreen = document.getElementById('end-screen');
    const langSelectButtons = document.querySelectorAll('.lang-select');
    const startButton = document.getElementById('start-button');
    const restartButton = document.getElementById('restart-button');
    const questionArea = document.getElementById('question-area');
    const feedbackArea = document.getElementById('feedback-area');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const animationContainer = document.getElementById('animation-container');
    const wheelSpinner = document.getElementById('wheel-spinner');
    const finalScoreEl = document.getElementById('final-score');
    const showSummaryButton = document.getElementById('show-summary');
    const feedbackCard = document.getElementById('feedback-card');

    // --- Translation Data ---
    const translations = {
        'en': {
            // UI Text
            "startTitle": "Hamster Wheel of Knowledge",
            "startSubtitle": "Help the hamster complete the \"Mini-Bibliography Marathon\"!",
            "startInstructions": "Answer citation questions correctly to make the hamster run faster. Wrong answers will make it stumble!",
            "startButton": "Start the Marathon!",
            "mainHeader": "Mini-Bibliography Marathon",
            "progressText": "{count} / {total} Questions",
            "checkAnswerButton": "Check Answer",
            "dragHereText": "Drag from here:",
            "correctFeedback": "Correct! The hamster speeds up!",
            "incorrectFeedback": "Not quite. The hamster stumbles...",
            "endTitle": "Marathon Complete!",
            "endMessage": "Great job! You helped the hamster finish the race!",
            "finalScoreText": "Final Score",
            "summaryTitle": "Key Takeaways ğŸ“",
            "summaryPoint1": "<b>Book Citation:</b> Author, <i>Title</i>, Year.",
            "summaryPoint2": "<b>Website Citation:</b> Organization, \"Article Title,\" Year, URL.",
            "summaryPoint3": "A bibliography gives credit to original authors!",
            "showSummaryButton": "Show Key Takeaways",
            "restartButton": "Run Again!",
            // Questions
            "questions": [
                { type: 'mcq', citation: 'Smith, John. italic(*Global Issues Today*). 2019.', question: "What part of the book citation is 'Smith, John'?", options: ['Title', 'Author', 'Year', 'Publisher'], answer: 'Author' },
                { type: 'mcq', citation: 'Smith, John. italic(*Global Issues Today*). 2019.', question: "What does '2019' represent in this book citation?", options: ['Page Number', 'Author\'s Age', 'Year of Publication', 'Chapter'], answer: 'Year of Publication' },
                { type: 'mcq', citation: 'Smith, John. italic(*Global Issues Today*). 2019.', question: "In a book citation, the title is usually...", options: ['in quotes', 'bolded', 'in italics', 'underlined'], answer: 'in italics' },
                { type: 'mcq', citation: 'UNICEF. "Children and Education." 2023. https://www.unicef.org/education', question: "What is 'UNICEF' in this website citation?", options: ['The Author', 'The Website Title', 'The Organization', 'The URL'], answer: 'The Organization' },
                { type: 'mcq', citation: 'UNICEF. "Children and Education." 2023. https://www.unicef.org/education', question: "What part of the website citation is 'Children and Education'?", options: ['Article Title', 'Main Website', 'Publisher', 'Author'], answer: 'Article Title' },
                { type: 'mcq', citation: 'UNICEF. "Children and Education." 2023. https://www.unicef.org/education', question: "What is the purpose of including the URL?", options: ['To show the author', 'To help readers find the source online', 'To list the publication year', 'To make it look longer'], answer: 'To help readers find the source online' },
                { type: 'dragdrop', question: 'Drag the parts to build a correct **book** citation:', prompt: 'Author. *Title*. Year.', parts: { Author: 'Crichton, Michael', Title: '*Jurassic Park*', Year: '1990' }, shuffled: ['1990', '*Jurassic Park*', 'Crichton, Michael'] },
                { type: 'dragdrop', question: 'Drag the parts to build a correct **website** citation:', prompt: 'Organization. "Article Title." Year. URL.', parts: { Organization: 'NASA', 'Article Title': '"Artemis I Mission"', Year: '2022', URL: 'https://www.nasa.gov/artemis-1' }, shuffled: ['https://www.nasa.gov/artemis-1', '2022', 'NASA', '"Artemis I Mission"'] },
                { type: 'mcq', citation: '', question: 'What is a bibliography?', options: ['A list of books you want to read', 'A list of sources used in research', 'An author\'s life story', 'A book about geography'], answer: 'A list of sources used in research' },
                { type: 'mcq', citation: '', question: 'Why is it important to cite your sources?', options: ['To make your paper longer', 'To show you are a good writer', 'To give credit to the original authors', 'To get a better grade'], answer: 'To give credit to the original authors' },
                { type: 'mcq', citation: 'Rowling, J.K. italic(*Harry Potter and the Sorcerer\'s Stone*). 1997.', question: 'Who is the author?', options: ['Harry Potter', 'J.K. Rowling', 'The Sorcerer', 'Stone'], answer: 'J.K. Rowling' },
                { type: 'mcq', citation: 'National Geographic. "Amazing Animals." 2021. https://kids.nationalgeographic.com/animals', question: 'Which part is the title of the article?', options: ['National Geographic', '"Amazing Animals"', '2021', 'The URL'], answer: '"Amazing Animals"' },
                { type: 'mcq', citation: '', question: 'If a book has two authors, how should they be listed?', options: ['Only the first author', 'In alphabetical order', 'In the order they appear on the cover', 'Only the second author'], answer: 'In the order they appear on the cover' },
                { type: 'mcq', citation: '', question: 'What does "et al." mean in a citation?', options: ['The end', 'And others', 'Extra information', 'See also'], answer: 'And others' },
                { type: 'mcq', citation: '', question: 'For a website, if there is no date, what should you write?', options: ['n.d.', 'No date', 'Unknown', 'Leave it blank'], answer: 'n.d.' },
                { type: 'dragdrop', question: 'Build a book citation with a publisher:', prompt: 'Author. *Title*. Publisher, Year.', parts: { Author: 'Dahl, Roald', Title: '*Matilda*', Publisher: 'Viking Kestrel', Year: '1988' }, shuffled: ['1988', '*Matilda*', 'Dahl, Roald', 'Viking Kestrel'] },
                { type: 'mcq', citation: '', question: 'What is the main purpose of a "mini-bibliography"?', options: ['To list every source ever made', 'To practice citing sources correctly', 'To write a long essay', 'To avoid doing research'], answer: 'To practice citing sources correctly' },
                { type: 'mcq', citation: '', question: 'When citing a website, what is the most important piece of information for finding it again?', options: ['The date', 'The author', 'The URL', 'The title'], answer: 'The URL' },
                { type: 'mcq', citation: 'Green, John. italic(*The Fault in Our Stars*). 2012.', question: 'What is the title of the book?', options: ['Green, John', '2012', '*The Fault in Our Stars*', 'A book about stars'], answer: '*The Fault in Our Stars*' },
                { type: 'mcq', citation: '', question: 'Where does a bibliography usually appear in a project?', options: ['At the beginning', 'In the middle', 'At the end', 'On a separate page'], answer: 'At the end' },
            ]
        },
        'zh': {
            "startTitle": "ä»“é¼ çŸ¥è¯†è½®",
            "startSubtitle": "å¸®åŠ©ä»“é¼ å®Œæˆâ€œè¿·ä½ å‚è€ƒä¹¦ç›®é©¬æ‹‰æ¾â€ï¼",
            "startInstructions": "æ­£ç¡®å›ç­”å¼•ç”¨é—®é¢˜ï¼Œè®©ä»“é¼ è·‘å¾—æ›´å¿«ã€‚ç­”é”™ä¼šä½¿å®ƒç»Šå€’ï¼",
            "startButton": "å¼€å§‹é©¬æ‹‰æ¾ï¼",
            "mainHeader": "è¿·ä½ å‚è€ƒä¹¦ç›®é©¬æ‹‰æ¾",
            "progressText": "{count} / {total} ä¸ªé—®é¢˜",
            "checkAnswerButton": "æ£€æŸ¥ç­”æ¡ˆ",
            "dragHereText": "ä»è¿™é‡Œæ‹–åŠ¨ï¼š",
            "correctFeedback": "æ­£ç¡®ï¼ä»“é¼ åŠ é€Ÿäº†ï¼",
            "incorrectFeedback": "ä¸å¯¹å“¦ã€‚ä»“é¼ ç»Šå€’äº†...",
            "endTitle": "é©¬æ‹‰æ¾å®Œæˆï¼",
            "endMessage": "å¹²å¾—å¥½ï¼ä½ å¸®åŠ©ä»“é¼ å®Œæˆäº†æ¯”èµ›ï¼",
            "finalScoreText": "æœ€ç»ˆå¾—åˆ†",
            "summaryTitle": "è¦ç‚¹å›é¡¾ ğŸ“",
            "summaryPoint1": "<b>ä¹¦ç±å¼•ç”¨ï¼š</b>ä½œè€…, <i>ä¹¦å</i>, å¹´ä»½ã€‚",
            "summaryPoint2": "<b>ç½‘ç«™å¼•ç”¨ï¼š</b>ç»„ç»‡, â€œæ–‡ç« æ ‡é¢˜â€, å¹´ä»½, ç½‘å€ã€‚",
            "summaryPoint3": "å‚è€ƒä¹¦ç›®æ˜¯ä¸ºäº†å‘åŸä½œè€…è‡´æ•¬ï¼",
            "showSummaryButton": "æ˜¾ç¤ºè¦ç‚¹",
            "restartButton": "å†è·‘ä¸€æ¬¡ï¼",
            "questions": [
                { type: 'mcq', citation: 'å²å¯†æ–¯, çº¦ç¿°. italic(*ä»Šæ—¥å…¨çƒé—®é¢˜*). 2019.', question: "ä¹¦ç±å¼•ç”¨ä¸­'å²å¯†æ–¯, çº¦ç¿°'æ˜¯å“ªä¸ªéƒ¨åˆ†ï¼Ÿ", options: ['ä¹¦å', 'ä½œè€…', 'å¹´ä»½', 'å‡ºç‰ˆå•†'], answer: 'ä½œè€…' },
                { type: 'mcq', citation: 'å²å¯†æ–¯, çº¦ç¿°. italic(*ä»Šæ—¥å…¨çƒé—®é¢˜*). 2019.', question: "è¿™ä¸ªä¹¦ç±å¼•ç”¨ä¸­çš„'2019'ä»£è¡¨ä»€ä¹ˆï¼Ÿ", options: ['é¡µç ', 'ä½œè€…å¹´é¾„', 'å‡ºç‰ˆå¹´ä»½', 'ç« èŠ‚'], answer: 'å‡ºç‰ˆå¹´ä»½' },
                { type: 'mcq', citation: 'å²å¯†æ–¯, çº¦ç¿°. italic(*ä»Šæ—¥å…¨çƒé—®é¢˜*). 2019.', question: "åœ¨ä¹¦ç±å¼•ç”¨ä¸­ï¼Œä¹¦åé€šå¸¸æ˜¯...", options: ['ç”¨å¼•å·', 'åŠ ç²—', 'ç”¨æ–œä½“', 'åŠ ä¸‹åˆ’çº¿'], answer: 'ç”¨æ–œä½“' },
                { type: 'mcq', citation: 'è”åˆå›½å„¿ç«¥åŸºé‡‘ä¼š. "å„¿ç«¥ä¸æ•™è‚²." 2023. https://www.unicef.org/education', question: "è¿™ä¸ªç½‘ç«™å¼•ç”¨ä¸­çš„'è”åˆå›½å„¿ç«¥åŸºé‡‘ä¼š'æ˜¯ä»€ä¹ˆï¼Ÿ", options: ['ä½œè€…', 'ç½‘ç«™æ ‡é¢˜', 'ç»„ç»‡', 'ç½‘å€'], answer: 'ç»„ç»‡' },
                { type: 'mcq', citation: 'è”åˆå›½å„¿ç«¥åŸºé‡‘ä¼š. "å„¿ç«¥ä¸æ•™è‚²." 2023. https://www.unicef.org/education', question: "ç½‘ç«™å¼•ç”¨ä¸­'å„¿ç«¥ä¸æ•™è‚²'æ˜¯å“ªä¸ªéƒ¨åˆ†ï¼Ÿ", options: ['æ–‡ç« æ ‡é¢˜', 'ä¸»ç½‘ç«™', 'å‡ºç‰ˆå•†', 'ä½œè€…'], answer: 'æ–‡ç« æ ‡é¢˜' },
                { type: 'mcq', citation: 'è”åˆå›½å„¿ç«¥åŸºé‡‘ä¼š. "å„¿ç«¥ä¸æ•™è‚²." 2023. https://www.unicef.org/education', question: "åŒ…å«ç½‘å€çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ", options: ['æ˜¾ç¤ºä½œè€…', 'å¸®åŠ©è¯»è€…åœ¨çº¿æ‰¾åˆ°æ¥æº', 'åˆ—å‡ºå‡ºç‰ˆå¹´ä»½', 'è®©å®ƒçœ‹èµ·æ¥æ›´é•¿'], answer: 'å¸®åŠ©è¯»è€…åœ¨çº¿æ‰¾åˆ°æ¥æº' },
                { type: 'dragdrop', question: 'æ‹–åŠ¨å„éƒ¨åˆ†ä»¥æ„å»ºä¸€ä¸ªæ­£ç¡®çš„**ä¹¦ç±**å¼•ç”¨ï¼š', prompt: 'ä½œè€…. *ä¹¦å*. å¹´ä»½.', parts: { Author: 'å…‹è±é¡¿, è¿ˆå…‹å°”', Title: '*ä¾ç½—çºªå…¬å›­*', Year: '1990' }, shuffled: ['1990', '*ä¾ç½—çºªå…¬å›­*', 'å…‹è±é¡¿, è¿ˆå…‹å°”'] },
                { type: 'dragdrop', question: 'æ‹–åŠ¨å„éƒ¨åˆ†ä»¥æ„å»ºä¸€ä¸ªæ­£ç¡®çš„**ç½‘ç«™**å¼•ç”¨ï¼š', prompt: 'ç»„ç»‡. "æ–‡ç« æ ‡é¢˜". å¹´ä»½. ç½‘å€.', parts: { Organization: 'ç¾å›½å›½å®¶èˆªç©ºèˆªå¤©å±€', 'Article Title': '"é˜¿å°”å¿’å¼¥æ–¯ä¸€å·ä»»åŠ¡"', Year: '2022', URL: 'https://www.nasa.gov/artemis-1' }, shuffled: ['https://www.nasa.gov/artemis-1', '2022', 'ç¾å›½å›½å®¶èˆªç©ºèˆªå¤©å±€', '"é˜¿å°”å¿’å¼¥æ–¯ä¸€å·ä»»åŠ¡"'] },
                { type: 'mcq', citation: '', question: 'ä»€ä¹ˆæ˜¯å‚è€ƒä¹¦ç›®ï¼Ÿ', options: ['ä½ æƒ³è¯»çš„ä¹¦çš„åˆ—è¡¨', 'ç ”ç©¶ä¸­ä½¿ç”¨çš„æ¥æºåˆ—è¡¨', 'ä½œè€…çš„ç”Ÿå¹³æ•…äº‹', 'å…³äºåœ°ç†çš„ä¹¦'], answer: 'ç ”ç©¶ä¸­ä½¿ç”¨çš„æ¥æºåˆ—è¡¨' },
                { type: 'mcq', citation: '', question: 'ä¸ºä»€ä¹ˆå¼•ç”¨æ¥æºå¾ˆé‡è¦ï¼Ÿ', options: ['è®©ä½ çš„è®ºæ–‡æ›´é•¿', 'æ˜¾ç¤ºä½ æ˜¯ä¸€ä¸ªå¥½ä½œå®¶', 'å‘åŸä½œè€…è‡´æ•¬', 'ä¸ºäº†å¾—åˆ°æ›´å¥½çš„æˆç»©'], answer: 'å‘åŸä½œè€…è‡´æ•¬' },
                { type: 'mcq', citation: 'ç½—ç³, J.K. italic(*å“ˆåˆ©Â·æ³¢ç‰¹ä¸é­”æ³•çŸ³*). 1997.', question: 'è°æ˜¯ä½œè€…ï¼Ÿ', options: ['å“ˆåˆ©Â·æ³¢ç‰¹', 'J.K. ç½—ç³', 'é­”æ³•å¸ˆ', 'çŸ³å¤´'], answer: 'J.K. ç½—ç³' },
                { type: 'mcq', citation: 'å›½å®¶åœ°ç†. "ç¥å¥‡çš„åŠ¨ç‰©." 2021. https://kids.nationalgeographic.com/animals', question: 'å“ªéƒ¨åˆ†æ˜¯æ–‡ç« çš„æ ‡é¢˜ï¼Ÿ', options: ['å›½å®¶åœ°ç†', '"ç¥å¥‡çš„åŠ¨ç‰©"', '2021', 'ç½‘å€'], answer: '"ç¥å¥‡çš„åŠ¨ç‰©"' },
                { type: 'mcq', citation: '', question: 'å¦‚æœä¸€æœ¬ä¹¦æœ‰ä¸¤ä½ä½œè€…ï¼Œåº”è¯¥å¦‚ä½•åˆ—å‡ºä»–ä»¬ï¼Ÿ', options: ['åªåˆ—ç¬¬ä¸€ä½ä½œè€…', 'æŒ‰å­—æ¯é¡ºåº', 'æŒ‰å°é¢ä¸Šå‡ºç°çš„é¡ºåº', 'åªåˆ—ç¬¬äºŒä½ä½œè€…'], answer: 'æŒ‰å°é¢ä¸Šå‡ºç°çš„é¡ºåº' },
                { type: 'mcq', citation: '', question: 'å¼•ç”¨ä¸­çš„â€œet al.â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ', options: ['ç»“æŸ', 'ä»¥åŠå…¶ä»–äºº', 'é¢å¤–ä¿¡æ¯', 'å¦è§'], answer: 'ä»¥åŠå…¶ä»–äºº' },
                { type: 'mcq', citation: '', question: 'å¯¹äºä¸€ä¸ªç½‘ç«™ï¼Œå¦‚æœæ²¡æœ‰æ—¥æœŸï¼Œä½ åº”è¯¥å†™ä»€ä¹ˆï¼Ÿ', options: ['n.d.', 'æ— æ—¥æœŸ', 'æœªçŸ¥', 'ç•™ç©º'], answer: 'n.d.' },
                { type: 'dragdrop', question: 'æ„å»ºä¸€ä¸ªå¸¦å‡ºç‰ˆå•†çš„ä¹¦ç±å¼•ç”¨ï¼š', prompt: 'ä½œè€…. *ä¹¦å*. å‡ºç‰ˆå•†, å¹´ä»½.', parts: { Author: 'è¾¾å°”, ç½—å°”å¾·', Title: '*ç›è’‚å°”è¾¾*', Publisher: 'ç»´äº¬çº¢éš¼', Year: '1988' }, shuffled: ['1988', '*ç›è’‚å°”è¾¾*', 'è¾¾å°”, ç½—å°”å¾·', 'ç»´äº¬çº¢éš¼'] },
                { type: 'mcq', citation: '', question: 'â€œè¿·ä½ å‚è€ƒä¹¦ç›®â€çš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ', options: ['åˆ—å‡ºæ‰€æœ‰æ›¾ç»çš„æ¥æº', 'ç»ƒä¹ æ­£ç¡®å¼•ç”¨æ¥æº', 'å†™ä¸€ç¯‡é•¿è®ºæ–‡', 'é¿å…åšç ”ç©¶'], answer: 'ç»ƒä¹ æ­£ç¡®å¼•ç”¨æ¥æº' },
                { type: 'mcq', citation: '', question: 'å¼•ç”¨ç½‘ç«™æ—¶ï¼Œå†æ¬¡æ‰¾åˆ°å®ƒçš„æœ€é‡è¦ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ', options: ['æ—¥æœŸ', 'ä½œè€…', 'ç½‘å€', 'æ ‡é¢˜'], answer: 'ç½‘å€' },
                { type: 'mcq', citation: 'æ ¼æ—, çº¦ç¿°. italic(*æ˜Ÿè¿é‡Œçš„é”™*). 2012.', question: 'è¿™æœ¬ä¹¦çš„ä¹¦åæ˜¯ä»€ä¹ˆï¼Ÿ', options: ['æ ¼æ—, çº¦ç¿°', '2012', '*æ˜Ÿè¿é‡Œçš„é”™*', 'ä¸€æœ¬å…³äºæ˜Ÿæ˜Ÿçš„ä¹¦'], answer: '*æ˜Ÿè¿é‡Œçš„é”™*' },
                { type: 'mcq', citation: '', question: 'å‚è€ƒä¹¦ç›®é€šå¸¸å‡ºç°åœ¨é¡¹ç›®çš„å“ªä¸ªä½ç½®ï¼Ÿ', options: ['å¼€å¤´', 'ä¸­é—´', 'ç»“å°¾', 'å•ç‹¬ä¸€é¡µ'], answer: 'ç»“å°¾' },
            ]
        },
        'tr': {
            "startTitle": "Bilgi Hamster TekerleÄŸi",
            "startSubtitle": "Hamster'Ä±n \"Mini-KaynakÃ§a Maratonu\"nu tamamlamasÄ±na yardÄ±m edin!",
            "startInstructions": "Hamster'Ä±n daha hÄ±zlÄ± koÅŸmasÄ± iÃ§in alÄ±ntÄ± sorularÄ±nÄ± doÄŸru cevaplayÄ±n. YanlÄ±ÅŸ cevaplar onu tÃ¶kezletir!",
            "startButton": "Maratona BaÅŸla!",
            "mainHeader": "Mini-KaynakÃ§a Maratonu",
            "progressText": "{count} / {total} Soru",
            "checkAnswerButton": "CevabÄ± Kontrol Et",
            "dragHereText": "Buradan sÃ¼rÃ¼kleyin:",
            "correctFeedback": "DoÄŸru! Hamster hÄ±zlanÄ±yor!",
            "incorrectFeedback": "Pek sayÄ±lmaz. Hamster tÃ¶kezliyor...",
            "endTitle": "Maraton TamamlandÄ±!",
            "endMessage": "Harika iÅŸ! Hamster'Ä±n yarÄ±ÅŸÄ± bitirmesine yardÄ±m ettin!",
            "finalScoreText": "Nihai Puan",
            "summaryTitle": "Ã–nemli Ã‡Ä±karÄ±mlar ğŸ“",
            "summaryPoint1": "<b>Kitap AlÄ±ntÄ±sÄ±:</b> Yazar, <i>BaÅŸlÄ±k</i>, YÄ±l.",
            "summaryPoint2": "<b>Web Sitesi AlÄ±ntÄ±sÄ±:</b> Organizasyon, \"Makale BaÅŸlÄ±ÄŸÄ±\", YÄ±l, URL.",
            "summaryPoint3": "KaynakÃ§a, orijinal yazarlara atÄ±fta bulunur!",
            "showSummaryButton": "Ã–nemli Ã‡Ä±karÄ±mlarÄ± GÃ¶ster",
            "restartButton": "Tekrar KoÅŸ!",
            "questions": [
                { type: 'mcq', citation: 'Smith, John. italic(*GÃ¼nÃ¼mÃ¼z KÃ¼resel SorunlarÄ±*). 2019.', question: "Kitap alÄ±ntÄ±sÄ±nÄ±n 'Smith, John' kÄ±smÄ± nedir?", options: ['BaÅŸlÄ±k', 'Yazar', 'YÄ±l', 'YayÄ±ncÄ±'], answer: 'Yazar' },
                { type: 'mcq', citation: 'Smith, John. italic(*GÃ¼nÃ¼mÃ¼z KÃ¼resel SorunlarÄ±*). 2019.', question: "Bu kitap alÄ±ntÄ±sÄ±nda '2019' neyi temsil ediyor?", options: ['Sayfa NumarasÄ±', 'YazarÄ±n YaÅŸÄ±', 'YayÄ±n YÄ±lÄ±', 'BÃ¶lÃ¼m'], answer: 'YayÄ±n YÄ±lÄ±' },
                { type: 'mcq', citation: 'Smith, John. italic(*GÃ¼nÃ¼mÃ¼z KÃ¼resel SorunlarÄ±*). 2019.', question: "Bir kitap alÄ±ntÄ±sÄ±nda baÅŸlÄ±k genellikle...", options: ['tÄ±rnak iÃ§inde', 'kalÄ±n', 'italik', 'altÄ± Ã§izili'], answer: 'italik' },
                { type: 'mcq', citation: 'UNICEF. "Ã‡ocuklar ve EÄŸitim." 2023. https://www.unicef.org/education', question: "Bu web sitesi alÄ±ntÄ±sÄ±nda 'UNICEF' nedir?", options: ['Yazar', 'Web Sitesi BaÅŸlÄ±ÄŸÄ±', 'Organizasyon', 'URL'], answer: 'Organizasyon' },
                { type: 'mcq', citation: 'UNICEF. "Ã‡ocuklar ve EÄŸitim." 2023. https://www.unicef.org/education', question: "Web sitesi alÄ±ntÄ±sÄ±nÄ±n 'Ã‡ocuklar ve EÄŸitim' kÄ±smÄ± nedir?", options: ['Makale BaÅŸlÄ±ÄŸÄ±', 'Ana Web Sitesi', 'YayÄ±ncÄ±', 'Yazar'], answer: 'Makale BaÅŸlÄ±ÄŸÄ±' },
                { type: 'mcq', citation: 'UNICEF. "Ã‡ocuklar ve EÄŸitim." 2023. https://www.unicef.org/education', question: "URL'yi dahil etmenin amacÄ± nedir?", options: ['YazarÄ± gÃ¶stermek', 'OkuyucularÄ±n kaynaÄŸÄ± Ã§evrimiÃ§i bulmasÄ±na yardÄ±mcÄ± olmak', 'YayÄ±n yÄ±lÄ±nÄ± listelemek', 'Daha uzun gÃ¶rÃ¼nmesini saÄŸlamak'], answer: 'OkuyucularÄ±n kaynaÄŸÄ± Ã§evrimiÃ§i bulmasÄ±na yardÄ±mcÄ± olmak' },
                { type: 'dragdrop', question: 'DoÄŸru bir **kitap** alÄ±ntÄ±sÄ± oluÅŸturmak iÃ§in parÃ§alarÄ± sÃ¼rÃ¼kleyin:', prompt: 'Yazar. *BaÅŸlÄ±k*. YÄ±l.', parts: { Author: 'Crichton, Michael', Title: '*Jurassic Park*', Year: '1990' }, shuffled: ['1990', '*Jurassic Park*', 'Crichton, Michael'] },
                { type: 'dragdrop', question: 'DoÄŸru bir **web sitesi** alÄ±ntÄ±sÄ± oluÅŸturmak iÃ§in parÃ§alarÄ± sÃ¼rÃ¼kleyin:', prompt: 'Organizasyon. "Makale BaÅŸlÄ±ÄŸÄ±". YÄ±l. URL.', parts: { Organization: 'NASA', 'Article Title': '"Artemis I GÃ¶revi"', Year: '2022', URL: 'https://www.nasa.gov/artemis-1' }, shuffled: ['https://www.nasa.gov/artemis-1', '2022', 'NASA', '"Artemis I GÃ¶revi"'] },
                { type: 'mcq', citation: '', question: 'KaynakÃ§a nedir?', options: ['Okumak istediÄŸiniz kitaplarÄ±n listesi', 'AraÅŸtÄ±rmada kullanÄ±lan kaynaklarÄ±n listesi', 'Bir yazarÄ±n hayat hikayesi', 'CoÄŸrafya hakkÄ±nda bir kitap'], answer: 'AraÅŸtÄ±rmada kullanÄ±lan kaynaklarÄ±n listesi' },
                { type: 'mcq', citation: '', question: 'KaynaklarÄ±nÄ±zÄ± belirtmek neden Ã¶nemlidir?', options: ['Makalenizi uzatmak iÃ§in', 'Ä°yi bir yazar olduÄŸunuzu gÃ¶stermek iÃ§in', 'Orijinal yazarlara atÄ±fta bulunmak iÃ§in', 'Daha iyi bir not almak iÃ§in'], answer: 'Orijinal yazarlara atÄ±fta bulunmak iÃ§in' },
                { type: 'mcq', citation: 'Rowling, J.K. italic(*Harry Potter ve Felsefe TaÅŸÄ±*). 1997.', question: 'Yazar kim?', options: ['Harry Potter', 'J.K. Rowling', 'Felsefeci', 'TaÅŸ'], answer: 'J.K. Rowling' },
                { type: 'mcq', citation: 'National Geographic. "Harika Hayvanlar." 2021. https://kids.nationalgeographic.com/animals', question: 'Makalenin baÅŸlÄ±ÄŸÄ± hangi kÄ±sÄ±mdÄ±r?', options: ['National Geographic', '"Harika Hayvanlar"', '2021', 'URL'], answer: '"Harika Hayvanlar"' },
                { type: 'mcq', citation: '', question: 'Bir kitabÄ±n iki yazarÄ± varsa, nasÄ±l listelenmelidirler?', options: ['Sadece ilk yazar', 'Alfabetik sÄ±rayla', 'Kapakta gÃ¶rÃ¼ndÃ¼kleri sÄ±rayla', 'Sadece ikinci yazar'], answer: 'Kapakta gÃ¶rÃ¼ndÃ¼kleri sÄ±rayla' },
                { type: 'mcq', citation: '', question: 'Bir alÄ±ntÄ±da "et al." ne anlama gelir?', options: ['Son', 'Ve diÄŸerleri', 'Ek bilgi', 'AyrÄ±ca bakÄ±nÄ±z'], answer: 'Ve diÄŸerleri' },
                { type: 'mcq', citation: '', question: 'Bir web sitesi iÃ§in tarih yoksa ne yazmalÄ±sÄ±nÄ±z?', options: ['t.y.', 'Tarih yok', 'Bilinmiyor', 'BoÅŸ bÄ±rak'], answer: 't.y.' },
                { type: 'dragdrop', question: 'YayÄ±ncÄ±lÄ± bir kitap alÄ±ntÄ±sÄ± oluÅŸturun:', prompt: 'Yazar. *BaÅŸlÄ±k*. YayÄ±ncÄ±, YÄ±l.', parts: { Author: 'Dahl, Roald', Title: '*Matilda*', Publisher: 'Viking Kestrel', Year: '1988' }, shuffled: ['1988', '*Matilda*', 'Dahl, Roald', 'Viking Kestrel'] },
                { type: 'mcq', citation: '', question: '"Mini-kaynakÃ§a"nÄ±n temel amacÄ± nedir?', options: ['Åimdiye kadar yapÄ±lmÄ±ÅŸ her kaynaÄŸÄ± listelemek', 'KaynaklarÄ± doÄŸru bir ÅŸekilde alÄ±ntÄ±lamayÄ± pratik etmek', 'Uzun bir makale yazmak', 'AraÅŸtÄ±rma yapmaktan kaÃ§Ä±nmak'], answer: 'KaynaklarÄ± doÄŸru bir ÅŸekilde alÄ±ntÄ±lamayÄ± pratik etmek' },
                { type: 'mcq', citation: '', question: 'Bir web sitesini alÄ±ntÄ±larken, onu tekrar bulmak iÃ§in en Ã¶nemli bilgi parÃ§asÄ± nedir?', options: ['Tarih', 'Yazar', 'URL', 'BaÅŸlÄ±k'], answer: 'URL' },
                { type: 'mcq', citation: 'Green, John. italic(*AynÄ± YÄ±ldÄ±zÄ±n AltÄ±nda*). 2012.', question: 'KitabÄ±n baÅŸlÄ±ÄŸÄ± nedir?', options: ['Green, John', '2012', '*AynÄ± YÄ±ldÄ±zÄ±n AltÄ±nda*', 'YÄ±ldÄ±zlar hakkÄ±nda bir kitap'], answer: '*AynÄ± YÄ±ldÄ±zÄ±n AltÄ±nda*' },
                { type: 'mcq', citation: '', question: 'KaynakÃ§a genellikle bir projenin neresinde yer alÄ±r?', options: ['BaÅŸÄ±nda', 'OrtasÄ±nda', 'Sonunda', 'AyrÄ± bir sayfada'], answer: 'Sonunda' },
            ]
        }
    };


    // --- Game State ---
    let currentQuestionIndex = 0;
    let score = 0;
    let hamsterSpeed = 0; // 0 = stopped, 1 = slow, 2 = medium, 3 = fast
    let rotationAngle = 0;
    let selectedLanguage = 'en';
    let currentQuestions = [];

    // --- Functions ---
    
    function selectLanguage(lang) {
        selectedLanguage = lang;
        currentQuestions = translations[lang].questions;
        updateUIText(lang);
        languageScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
    }

    function updateUIText(lang) {
        const t = translations[lang];
        document.getElementById('start-title').textContent = t.startTitle;
        document.getElementById('start-subtitle').textContent = t.startSubtitle;
        document.getElementById('start-instructions').textContent = t.startInstructions;
        document.getElementById('start-button').textContent = t.startButton;
        document.getElementById('main-header').textContent = t.mainHeader;
        document.getElementById('end-title').textContent = t.endTitle;
        document.getElementById('end-message').textContent = t.endMessage;
        document.getElementById('final-score-text').textContent = t.finalScoreText;
        document.getElementById('summary-title').textContent = t.summaryTitle;
        document.getElementById('show-summary').textContent = t.showSummaryButton;
        document.getElementById('restart-button').textContent = t.restartButton;
        const summaryList = document.getElementById('summary-list');
        summaryList.innerHTML = `
            <li>${t.summaryPoint1}</li>
            <li>${t.summaryPoint2}</li>
            <li>${t.summaryPoint3}</li>
        `;
    }


    function startGame() {
        currentQuestionIndex = 0;
        score = 0;
        hamsterSpeed = 0;
        rotationAngle = 0;
        startScreen.classList.add('hidden');
        endScreen.classList.add('hidden');
        mainGame.classList.remove('hidden');
        feedbackCard.classList.remove('flipped');
        updateProgressBarUI();
        updateHamsterSpeed();
        displayQuestion();
    }

    function displayQuestion() {
        feedbackArea.innerHTML = '';
        const q = currentQuestions[currentQuestionIndex];
        let html = '';

        if (q.citation) {
            const formattedCitation = q.citation.replace(/italic\((.*?)\)/g, '<i class=\"text-slate-700\">$1</i>');
            html += `<p class="text-center text-slate-500 bg-slate-100 p-3 rounded-lg mb-4 text-sm md:text-base">${formattedCitation}</p>`;
        }
        
        html += `<h3 class="text-xl font-semibold text-slate-800 mb-4">${q.question}</h3>`;

        if (q.type === 'mcq') {
            html += '<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">';
            q.options.forEach(option => {
                html += `<button class="mcq-option w-full bg-white hover:bg-sky-100 text-slate-700 p-3 rounded-lg border-2 border-slate-300 transition-all duration-200">${option}</button>`;
            });
            html += '</div>';
        } else if (q.type === 'dragdrop') {
            html += `<p class="text-center text-indigo-600 bg-indigo-100 p-2 rounded-lg mb-4 font-semibold">${q.prompt}</p>`;
            html += '<div class="space-y-3 mb-4">';
            const t = translations[selectedLanguage];
            Object.keys(q.parts).forEach(partName => {
                html += `
                    <div class="flex items-center gap-2">
                        <span class="font-medium text-slate-600 w-28 text-right">${partName}:</span>
                        <div class="drop-zone flex-1 bg-slate-100 border-2 border-dashed border-slate-400 rounded-lg p-3 h-12" data-part="${partName}"></div>
                    </div>
                `;
            });
            html += '</div>';
            html += `<p class="text-sm text-center text-slate-500 mb-2">${t.dragHereText}</p>`;
            html += '<div class="flex flex-wrap gap-2 justify-center">';
            q.shuffled.forEach(part => {
                html += `<div class="draggable bg-white cursor-grab p-2 rounded-lg border-2 border-amber-400 shadow" draggable="true" data-value="${part}">${part.replace(/\*/g, '')}</div>`;
            });
            html += '</div>';
            html += `<button id="check-dragdrop" class="mt-4 w-full bg-indigo-500 text-white p-3 rounded-lg font-bold hover:bg-indigo-600">${t.checkAnswerButton}</button>`;
        }

        questionArea.innerHTML = html;
        addQuestionListeners();
    }

    function addQuestionListeners() {
        if (currentQuestions[currentQuestionIndex].type === 'mcq') {
            document.querySelectorAll('.mcq-option').forEach(button => {
                button.addEventListener('click', handleMCQAnswer);
            });
        } else if (currentQuestions[currentQuestionIndex].type === 'dragdrop') {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.value);
                    setTimeout(() => e.target.classList.add('opacity-50'), 0);
                });
                draggable.addEventListener('dragend', (e) => {
                    e.target.classList.remove('opacity-50');
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('over');
                });
                zone.addEventListener('dragleave', (e) => {
                    zone.classList.remove('over');
                });
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('over');
                    const data = e.dataTransfer.getData('text/plain');
                    
                    if (zone.children.length > 0) {
                        const existingDraggable = zone.children[0];
                        const originalContainer = document.querySelector('.flex-wrap.gap-2.justify-center');
                        if (originalContainer) {
                             originalContainer.appendChild(existingDraggable);
                        }
                    }

                    const draggableElement = Array.from(draggables).find(d => d.dataset.value === data);
                    if (draggableElement) {
                        zone.appendChild(draggableElement);
                        draggableElement.classList.remove('cursor-grab');
                        draggableElement.classList.add('cursor-default');
                    }
                });
            });
            
            document.getElementById('check-dragdrop').addEventListener('click', handleDragDropAnswer);
        }
    }

    function handleMCQAnswer(event) {
        const selectedAnswer = event.target.textContent;
        const correctAnswer = currentQuestions[currentQuestionIndex].answer;
        const isCorrect = selectedAnswer === correctAnswer;

        document.querySelectorAll('.mcq-option').forEach(button => {
            button.disabled = true;
            if (button.textContent === correctAnswer) {
                button.classList.add('bg-green-500', 'text-white', 'border-green-600');
            } else if (button.textContent === selectedAnswer) {
                button.classList.add('bg-red-500', 'text-white', 'border-red-600');
            }
        });

        showFeedback(isCorrect);
    }
    
    function handleDragDropAnswer() {
        const q = currentQuestions[currentQuestionIndex].parts;
        let allCorrect = true;
        
        document.querySelectorAll('.drop-zone').forEach(zone => {
           const partName = zone.dataset.part;
           const droppedElement = zone.querySelector('.draggable');
           const droppedValue = droppedElement ? droppedElement.dataset.value : null;

           if(q[partName] === droppedValue) {
               zone.classList.add('correct');
           } else {
               zone.classList.add('incorrect');
               allCorrect = false;
           }
        });
        
        document.getElementById('check-dragdrop').disabled = true;
        showFeedback(allCorrect);
    }


    function showFeedback(isCorrect) {
        let message = '';
        const t = translations[selectedLanguage];
        if (isCorrect) {
            score++;
            hamsterSpeed = Math.min(3, hamsterSpeed + 1);
            message = `<div class="bg-green-100 text-green-800 p-3 rounded-lg font-semibold">${t.correctFeedback}</div>`;
            animationContainer.classList.remove('stumble');
        } else {
            hamsterSpeed = Math.max(0, hamsterSpeed - 1);
            message = `<div class="bg-red-100 text-red-800 p-3 rounded-lg font-semibold">${t.incorrectFeedback}</div>`;
            animationContainer.classList.add('stumble');
            setTimeout(() => animationContainer.classList.remove('stumble'), 500);
        }
        feedbackArea.innerHTML = message;

        updateHamsterSpeed();
        updateProgressBarUI();

        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                displayQuestion();
            } else {
                endGame();
            }
        }, 2000);
    }

    function updateProgressBarUI() {
        const progress = (currentQuestionIndex / currentQuestions.length) * 100;
        progressBar.style.width = `${progress}%`;
        progressText.textContent = translations[selectedLanguage].progressText
            .replace('{count}', currentQuestionIndex)
            .replace('{total}', currentQuestions.length);
    }


    function updateHamsterSpeed() {
        const hamsterEl = document.getElementById('hamster');
        if (hamsterSpeed > 0) {
            animationContainer.classList.add('running');
            const duration = 1.5 - (hamsterSpeed * 0.4);
            hamsterEl.style.animationDuration = `${duration}s`;
            
            const rotationSpeed = hamsterSpeed * 3;
            function rotateWheel() {
                if (hamsterSpeed > 0 && mainGame.offsetParent !== null) {
                     rotationAngle = (rotationAngle + rotationSpeed) % 360;
                     wheelSpinner.style.transform = `rotate(${rotationAngle}deg)`;
                     requestAnimationFrame(rotateWheel);
                }
            }
            requestAnimationFrame(rotateWheel);

        } else {
            animationContainer.classList.remove('running');
        }
    }

    function endGame() {
        mainGame.classList.add('hidden');
        endScreen.classList.remove('hidden');
        finalScoreEl.textContent = `${score} / ${currentQuestions.length}`;
        hamsterSpeed = 0;
        animationContainer.classList.remove('running');
        progressBar.style.width = '100%';
        progressText.textContent = translations[selectedLanguage].progressText
            .replace('{count}', currentQuestions.length)
            .replace('{total}', currentQuestions.length);
    }

    // --- Event Listeners ---
    langSelectButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            selectLanguage(e.target.dataset.lang);
        });
    });
    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', () => {
        endScreen.classList.add('hidden');
        languageScreen.classList.remove('hidden');
    });
    showSummaryButton.addEventListener('click', () => {
        feedbackCard.classList.toggle('flipped');
    });

</script>
</body>
</html>

