<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Process Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7fc;
        }
        .step-card {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .hidden-step {
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            position: absolute;
            pointer-events: none;
            width: 100%;
        }
        .visible-step {
            opacity: 1;
            transform: translateY(0) scale(1);
            position: static;
            pointer-events: auto;
        }
        /* Fun animation for the mascot */
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .mascot {
            animation: bounce 2s infinite;
        }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake {
          animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 space-y-4 relative">
        
        <div class="absolute top-4 right-4 z-10">
            <select id="languageSelector" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                <option value="en">English</option>
                <option value="zh">中文</option>
                <option value="ru">Русский</option>
            </select>
        </div>

        <header class="text-center space-y-4 pt-8">
            <div class="flex justify-center items-center gap-3">
                <svg class="w-12 h-12 text-yellow-400 mascot" xmlns="http://www.w.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a7.5 7.5 0 01-7.5 0c.887.67 2.012.984 3.25.984s2.363-.314 3.25-.984zM6.75 12.75a5.25 5.25 0 017.5 0 .75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.125 0 .25-.008.374-.024a.75.75 0 01.282.282A6.72 6.72 0 0012 21a8.25 8.25 0 01-8.25-8.25 8.25 8.25 0 018.25-8.25c4.545 0 8.25 3.705 8.25 8.25a6.72 6.72 0 00-.543 2.868.75.75 0 01.282-.282A8.962 8.962 0 0021 12c0-4.97-4.03-9-9-9z" />
                </svg>
                <h1 class="text-3xl font-bold text-indigo-600" data-lang-key="title">Research Process Adventure</h1>
            </div>
            <div>
                <div id="progressText" class="text-sm text-gray-600 font-medium mb-1" data-lang-key="progress_step1">Step 1 of 6: The Big Question</div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full" style="width: 10%; transition: width 0.5s ease-in-out;"></div>
                </div>
            </div>
        </header>

        <div class="relative min-h-[500px]">
             <!-- Step 1: Identify the Question -->
            <div id="step1" class="step-card visible-step">
                <div class="p-6 bg-indigo-50 rounded-lg border-2 border-indigo-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step1_heading">Step 1: Identify the Question</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step1_subheading">Good research starts with a great question. Turn a broad topic into a focused one!</p>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700" data-lang-key="step1_topic_label">Here's a broad topic:</label>
                        <p id="topicDisplay" class="mt-1 w-full p-3 bg-gray-100 rounded-md font-semibold text-lg text-gray-900"></p>
                    </div>
                    <div class="mt-4">
                        <label for="researchQuestion" class="block text-sm font-medium text-gray-700" data-lang-key="step1_question_label">Now, make it a specific, researchable question:</label>
                        <textarea id="researchQuestion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" data-lang-key="step1_placeholder" placeholder="e.g., How does playing team-based video games affect teenage communication skills?"></textarea>
                        <p id="questionError" class="text-red-500 text-sm mt-1 hidden" data-lang-key="step1_error">Please write a more specific question (at least 10 characters).</p>
                    </div>
                     <div class="mt-6 text-center">
                        <button id="nextStepBtn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105" data-lang-key="step1_button">
                            Plan My Research &rarr;
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Plan the Research -->
            <div id="step2" class="step-card hidden-step">
                <div class="p-6 bg-teal-50 rounded-lg border-2 border-teal-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step2_heading">Step 2: Plan the Research</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step2_subheading">A great plan uses reliable sources. Which would you use to answer your question?</p>
                    <div class="mt-4 p-3 bg-gray-100 rounded-md">
                        <p class="text-sm font-medium text-gray-600" data-lang-key="step2_your_question">Your Question:</p>
                        <p id="questionDisplay2" class="font-semibold text-gray-800"></p>
                    </div>
                    <div id="sourceList" class="mt-4 space-y-3"></div>
                    <div class="mt-6 text-center">
                        <button id="checkPlanBtn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105" data-lang-key="step2_button">
                            Check My Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Gather Information -->
            <div id="step3" class="step-card hidden-step">
                <div class="p-6 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step3_heading">Step 3: Gather Information</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step3_subheading">Now that you have a plan, where will you find your information? Choose the most effective places.</p>
                    <div class="mt-4 p-3 bg-gray-100 rounded-md">
                        <p class="text-sm font-medium text-gray-600" data-lang-key="step2_your_question">Your Question:</p>
                        <p id="questionDisplay3" class="font-semibold text-gray-800"></p>
                    </div>
                    <div id="gatherList" class="mt-4 space-y-3"></div>
                    <div class="mt-6 text-center">
                        <button id="checkGatherBtn" class="bg-yellow-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-transform transform hover:scale-105" data-lang-key="step3_button">
                            Check My Sources
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Evaluate Sources -->
            <div id="step4" class="step-card hidden-step">
                 <div class="p-6 bg-purple-50 rounded-lg border-2 border-purple-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step4_heading">Step 4: Evaluate Sources</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step4_subheading">A smart researcher is a skeptical researcher. Read the source description below. What's wrong with it?</p>
                    <div class="mt-4 p-3 bg-gray-100 rounded-md">
                        <p id="evalSource" class="text-sm text-gray-800 italic"></p>
                    </div>
                    <div id="evalFlaws" class="mt-4 space-y-3"></div>
                    <div class="mt-6 text-center">
                        <button id="checkEvalBtn" class="bg-purple-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-transform transform hover:scale-105" data-lang-key="step4_button">
                            Check Evaluation
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Organize and Analyze -->
            <div id="step5" class="step-card hidden-step">
                <div class="p-6 bg-pink-50 rounded-lg border-2 border-pink-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step5_heading">Step 5: Organize and Analyze</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step5_subheading">Good notes are organized. Look at this piece of information. How would you categorize it?</p>
                     <div class="mt-4 p-3 bg-gray-100 rounded-md">
                        <p class="text-sm font-medium text-gray-600" data-lang-key="step5_info_label">Information Found:</p>
                        <p id="organizeInfo" class="font-semibold text-gray-800"></p>
                    </div>
                    <div id="organizeCategories" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
                    <p id="organizeFeedback" class="text-center font-bold mt-4 text-lg opacity-0 transition-opacity"></p>
                    <div class="mt-6 text-center">
                         <button id="finishBtn" class="bg-pink-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-transform transform hover:scale-105 disabled:opacity-50" disabled data-lang-key="step5_button">
                            See My Score!
                        </button>
                    </div>
                </div>
            </div>

            <!-- Completion Screen -->
            <div id="completionScreen" class="step-card hidden-step text-center">
                 <div class="p-6 bg-green-50 rounded-lg border-2 border-green-200">
                    <svg class="mx-auto h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 id="finalTitle" class="text-2xl font-semibold text-gray-800 mt-4" data-lang-key="finish_excellent_title">Great Job!</h2>
                    <p id="finalMessage" class="text-gray-600 mt-2" data-lang-key="finish_excellent_msg">You've completed the research prep. You're on your way to becoming a research expert!</p>
                    <div id="finalScore" class="text-md font-bold text-indigo-600 mt-4 space-y-1"></div>
                    <div class="mt-6">
                        <button id="restartBtn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105" data-lang-key="finish_button">
                            Play Again
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const steps = {
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step4: document.getElementById('step4'),
            step5: document.getElementById('step5'),
            completion: document.getElementById('completionScreen'),
        };

        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const languageSelector = document.getElementById('languageSelector');

        // Step 1 Elements
        const topicDisplay = document.getElementById('topicDisplay');
        const researchQuestionInput = document.getElementById('researchQuestion');
        const questionError = document.getElementById('questionError');
        const nextStepBtn = document.getElementById('nextStepBtn');

        // Step 2 Elements
        const questionDisplay2 = document.getElementById('questionDisplay2');
        const sourceListContainer = document.getElementById('sourceList');
        const checkPlanBtn = document.getElementById('checkPlanBtn');

        // Step 3 Elements
        const questionDisplay3 = document.getElementById('questionDisplay3');
        const gatherListContainer = document.getElementById('gatherList');
        const checkGatherBtn = document.getElementById('checkGatherBtn');
        
        // Step 4 Elements
        const evalSource = document.getElementById('evalSource');
        const evalFlawsContainer = document.getElementById('evalFlaws');
        const checkEvalBtn = document.getElementById('checkEvalBtn');
        
        // Step 5 Elements
        const organizeInfo = document.getElementById('organizeInfo');
        const organizeCategoriesContainer = document.getElementById('organizeCategories');
        const organizeFeedback = document.getElementById('organizeFeedback');
        const finishBtn = document.getElementById('finishBtn');

        // Completion Screen Elements
        const finalTitle = document.getElementById('finalTitle');
        const finalMessage = document.getElementById('finalMessage');
        const finalScore = document.getElementById('finalScore');
        const restartBtn = document.getElementById('restartBtn');

        let scores = { step2: 0, step3: 0, step4: 0, step5: 0 };
        let currentLang = 'en';
        
        const lang = {
            en: {
                title: "Research Process Adventure",
                progress_step1: "Step 1 of 6: The Big Question",
                progress_step2: "Step 2 of 6: The Master Plan",
                progress_step3: "Step 3 of 6: Gathering Clues",
                progress_step4: "Step 4 of 6: Detective Work",
                progress_step5: "Step 5 of 6: Getting Organized",
                progress_step6: "Complete!",
                step1_heading: "Step 1: Identify the Question",
                step1_subheading: "Good research starts with a great question. Turn a broad topic into a focused one!",
                step1_topic_label: "Here's a broad topic:",
                step1_question_label: "Now, make it a specific, researchable question:",
                step1_placeholder: "e.g., How does playing team-based video games affect teenage communication skills?",
                step1_error: "Please write a more specific question (at least 10 characters).",
                step1_button: "Plan My Research &rarr;",
                step2_heading: "Step 2: Plan the Research",
                step2_subheading: "A great plan uses reliable sources. Which would you use to answer your question?",
                step2_your_question: "Your Question:",
                step2_sources_label: "Select your sources:",
                step2_button: "Check My Plan",
                step2_button_next: "Gather Info &rarr;",
                step3_heading: "Step 3: Gather Information",
                step3_subheading: "Now that you have a plan, where will you find your information? Choose the most effective places.",
                step3_locations_label: "Select where you'll search:",
                step3_button: "Check My Sources",
                step3_button_next: "Evaluate Sources &rarr;",
                step4_heading: "Step 4: Evaluate Sources",
                step4_subheading: "A smart researcher is a skeptical researcher. Read the source description below. What's wrong with it?",
                step4_button: "Check Evaluation",
                step4_button_next: "Organize &rarr;",
                step5_heading: "Step 5: Organize and Analyze",
                step5_subheading: "Good notes are organized. Look at this piece of information. How would you categorize it?",
                step5_info_label: "Information Found:",
                step5_button: "See My Score!",
                feedback_correct: "Correct!",
                feedback_incorrect: "Try Again!",
                feedback_reliable: "✔️ Reliable",
                feedback_unreliable: "❌ Unreliable",
                feedback_effective: "✔️ Effective",
                feedback_ineffective: "❌ Ineffective",
                feedback_is_flaw: "✔️ Good catch!",
                feedback_not_flaw: "❌ Look closer...",
                finish_excellent_title: "Excellent Work!",
                finish_excellent_msg: "You're a research superstar! You've mastered the foundational skills of a great researcher.",
                finish_good_title: "Good Job!",
                finish_good_msg: "You're getting the hang of it! With a little more practice, you'll be an expert.",
                finish_try_again_title: "Nice Try!",
                finish_try_again_msg: "Every expert starts somewhere. Review your answers and try again to improve your skills!",
                finish_score_label_step2: "Plan Score:",
                finish_score_label_step3: "Gathering Score:",
                finish_score_label_step4: "Evaluation Score:",
                finish_score_label_step5: "Organizing Score:",
                finish_score_label_total: "Total Score:",
                finish_button: "Play Again",
            },
            zh: { /* Chinese translations */ },
            ru: { /* Russian translations */ }
        };
        const topics = { en: ["The impact of video games on teenagers", "Climate change and its effect on polar bears", "The history of the internet", "Healthy eating habits for students", "The rise of social media influencers"], zh: [], ru: [] };
        const sources = { 
            en: [
                { name: "Scholarly Journals (e.g., JSTOR)", reliable: true }, 
                { name: "Government Reports (e.g., NASA, WHO)", reliable: true }, 
                { name: "Reputable News Organizations (e.g., BBC, AP)", reliable: true },
                { name: "Books by recognized experts", reliable: true },
                { name: "Wikipedia", reliable: false }, 
                { name: "Personal Blogs", reliable: false },
                { name: "Social Media Posts", reliable: false },
                { name: "An encyclopedia from 1985", reliable: false }
            ], 
            zh: [], ru: [] 
        };
        const gatheringLocations = { 
            en: [
                { name: "Your school library's online database", effective: true }, 
                { name: "Interviewing a university professor", effective: true }, 
                { name: "Government statistics websites", effective: true },
                { name: "A documentary from a known filmmaker", effective: true },
                { name: "A popular online forum about the topic", effective: false },
                { name: "The comments section of a news article", effective: false },
                { name: "A random YouTube video with lots of views", effective: false }
            ], 
            zh: [], ru: [] 
        };
        const evaluationScenarios = { 
            en: {
                source: "An article on 'GamersAreSmarter.com' claims video games double your IQ. The author is listed as 'ProGamer22' and the article was published in 2012.",
                flaws: [
                    { text: "The website name sounds biased.", is_flaw: true },
                    { text: "The author is anonymous.", is_flaw: true },
                    { text: "The information is old (from 2012).", is_flaw: true },
                    { text: "The article is on the internet.", is_flaw: false }
                ]
            }, 
            zh: {}, ru: {} 
        };
        const organizationTasks = {
            en: {
                info: "A 2021 study by Oxford University found no causal link between time spent playing games and well-being.",
                categories: [
                    { text: "Argument For Video Games", correct: false },
                    { text: "Argument Against Video Games", correct: false },
                    { text: "Neutral Scientific Finding", correct: true },
                    { text: "An Opinion", correct: false }
                ]
            },
            zh: {}, ru: {}
        };

        function setLanguage(langCode) {
            currentLang = langCode;
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (lang[langCode] && lang[langCode][key]) {
                    if (el.tagName === 'TEXTAREA') el.placeholder = lang[langCode][key];
                    else el.innerHTML = lang[langCode][key];
                }
            });
        }

        languageSelector.addEventListener('change', (e) => {
            setLanguage(e.target.value);
            initializeGame(true);
        });

        function updateProgress(step, textKey) {
            const percentage = { 1: 10, 2: 25, 3: 45, 4: 65, 5: 85, 6: 100 };
            progressBar.style.width = `${percentage[step]}%`;
            progressText.textContent = (lang[currentLang] && lang[currentLang][textKey]) ? lang[currentLang][textKey] : textKey;
        }

        function switchStep(from, to, isInstant = false) {
            from.classList.remove('visible-step');
            from.classList.add('hidden-step');
            
            setTimeout(() => {
                to.classList.remove('hidden-step');
                to.classList.add('visible-step');
            }, isInstant ? 0 : 500);
        }

        function initializeGame(languageChange = false) {
            if (!languageChange) {
                switchStep(steps.completion, steps.step1, true);
            }
            updateProgress(1, 'progress_step1');

            researchQuestionInput.value = '';
            scores = { step2: 0, step3: 0, step4: 0, step5: 0 };
            
            // Reset buttons
            checkPlanBtn.textContent = lang[currentLang].step2_button;
            checkPlanBtn.disabled = false;
            checkPlanBtn.onclick = handleCheckPlan;

            checkGatherBtn.textContent = lang[currentLang].step3_button;
            checkGatherBtn.disabled = false;
            checkGatherBtn.onclick = handleCheckGather;
            
            checkEvalBtn.textContent = lang[currentLang].step4_button;
            checkEvalBtn.disabled = false;
            checkEvalBtn.onclick = handleCheckEvaluation;
            
            finishBtn.disabled = true;

            // Step 1
            const randomTopic = topics[currentLang][Math.floor(Math.random() * topics[currentLang].length)];
            topicDisplay.textContent = randomTopic;

            // Step 2
            sourceListContainer.innerHTML = '';
            sources[currentLang].forEach((source, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-white rounded-md border hover:border-indigo-300';
                div.innerHTML = `<div class="flex items-center"><input id="source-${index}" type="checkbox" data-reliable="${source.reliable}" class="h-5 w-5 rounded"><label for="source-${index}" class="ml-3">${source.name}</label></div><div id="feedback-source-${index}" class="text-sm font-bold opacity-0"></div>`;
                sourceListContainer.appendChild(div);
            });

            // Step 3
             gatherListContainer.innerHTML = '';
             gatheringLocations[currentLang].forEach((loc, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-white rounded-md border hover:border-yellow-300';
                div.innerHTML = `<div class="flex items-center"><input id="loc-${index}" type="checkbox" data-effective="${loc.effective}" class="h-5 w-5 rounded"><label for="loc-${index}" class="ml-3">${loc.name}</label></div><div id="feedback-loc-${index}" class="text-sm font-bold opacity-0"></div>`;
                gatherListContainer.appendChild(div);
            });
            
            // Step 4
            evalSource.textContent = evaluationScenarios[currentLang].source;
            evalFlawsContainer.innerHTML = '';
            evaluationScenarios[currentLang].flaws.forEach((flaw, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-white rounded-md border hover:border-purple-300';
                div.innerHTML = `<div class="flex items-center"><input id="flaw-${index}" type="checkbox" data-is-flaw="${flaw.is_flaw}" class="h-5 w-5 rounded"><label for="flaw-${index}" class="ml-3">${flaw.text}</label></div><div id="feedback-flaw-${index}" class="text-sm font-bold opacity-0"></div>`;
                evalFlawsContainer.appendChild(div);
            });
            
            // Step 5
            organizeInfo.textContent = organizationTasks[currentLang].info;
            organizeCategoriesContainer.innerHTML = '';
            organizeFeedback.classList.add('opacity-0');
            organizationTasks[currentLang].categories.forEach((cat, index) => {
                const button = document.createElement('button');
                button.className = 'p-4 bg-white rounded-md border text-left font-medium hover:border-pink-400 hover:bg-pink-100 transition';
                button.textContent = cat.text;
                button.onclick = () => handleOrganizeChoice(cat.correct, button);
                organizeCategoriesContainer.appendChild(button);
            });
        }

        nextStepBtn.addEventListener('click', () => {
            const userQuestion = researchQuestionInput.value.trim();
            if (userQuestion.length < 10) {
                questionError.classList.remove('hidden');
                researchQuestionInput.classList.add('shake');
                return;
            }
            questionError.classList.add('hidden');
            researchQuestionInput.classList.remove('shake');
            questionDisplay2.textContent = userQuestion;
            updateProgress(2, 'progress_step2');
            switchStep(steps.step1, steps.step2);
        });

        function handleCheckPlan() {
            let correct = 0, incorrect = 0;
            sourceListContainer.querySelectorAll('input').forEach((cb, i) => {
                const isReliable = cb.dataset.reliable === 'true';
                const feedbackEl = document.getElementById(`feedback-source-${i}`);
                if (cb.checked) {
                    if (isReliable) { correct++; feedbackEl.innerHTML = `<span class="text-green-600">${lang[currentLang].feedback_reliable}</span>`; }
                    else { incorrect++; feedbackEl.innerHTML = `<span class="text-red-600">${lang[currentLang].feedback_unreliable}</span>`; }
                    feedbackEl.classList.remove('opacity-0');
                }
                cb.disabled = true;
            });
            scores.step2 = Math.max(0, (correct * 2) - incorrect);
            checkPlanBtn.textContent = lang[currentLang].step2_button_next;
            checkPlanBtn.onclick = () => {
                questionDisplay3.textContent = researchQuestionInput.value.trim();
                updateProgress(3, 'progress_step3');
                switchStep(steps.step2, steps.step3);
            };
        }

        function handleCheckGather() {
            let correct = 0, incorrect = 0;
            gatherListContainer.querySelectorAll('input').forEach((cb, i) => {
                const isEffective = cb.dataset.effective === 'true';
                const feedbackEl = document.getElementById(`feedback-loc-${i}`);
                 if (cb.checked) {
                    if (isEffective) { correct++; feedbackEl.innerHTML = `<span class="text-green-600">${lang[currentLang].feedback_effective}</span>`; }
                    else { incorrect++; feedbackEl.innerHTML = `<span class="text-red-600">${lang[currentLang].feedback_ineffective}</span>`; }
                    feedbackEl.classList.remove('opacity-0');
                }
                cb.disabled = true;
            });
            scores.step3 = Math.max(0, (correct * 2) - incorrect);
            checkGatherBtn.textContent = lang[currentLang].step3_button_next;
            checkGatherBtn.onclick = () => {
                updateProgress(4, 'progress_step4');
                switchStep(steps.step3, steps.step4);
            };
        }

        function handleCheckEvaluation() {
             let correct = 0, incorrect = 0;
            evalFlawsContainer.querySelectorAll('input').forEach((cb, i) => {
                const isFlaw = cb.dataset.isFlaw === 'true';
                 const feedbackEl = document.getElementById(`feedback-flaw-${i}`);
                 if (cb.checked) {
                    if (isFlaw) { correct++; feedbackEl.innerHTML = `<span class="text-green-600">${lang[currentLang].feedback_is_flaw}</span>`; }
                    else { incorrect++; feedbackEl.innerHTML = `<span class="text-red-600">${lang[currentLang].feedback_not_flaw}</span>`; }
                    feedbackEl.classList.remove('opacity-0');
                }
                cb.disabled = true;
            });
            scores.step4 = Math.max(0, (correct * 2) - incorrect);
            checkEvalBtn.textContent = lang[currentLang].step4_button_next;
            checkEvalBtn.onclick = () => {
                updateProgress(5, 'progress_step5');
                switchStep(steps.step4, steps.step5);
            };
        }

        function handleOrganizeChoice(isCorrect, buttonEl) {
            organizeCategoriesContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            if (isCorrect) {
                scores.step5 = 5;
                buttonEl.classList.add('bg-green-200', 'border-green-500');
                organizeFeedback.textContent = lang[currentLang].feedback_correct;
                organizeFeedback.className = 'text-center font-bold mt-4 text-lg text-green-600 opacity-100';
            } else {
                scores.step5 = 0;
                buttonEl.classList.add('bg-red-200', 'border-red-500');
                 organizeFeedback.textContent = lang[currentLang].feedback_incorrect;
                organizeFeedback.className = 'text-center font-bold mt-4 text-lg text-red-600 opacity-100';
            }
            finishBtn.disabled = false;
        }

        finishBtn.addEventListener('click', () => {
            const totalScore = scores.step2 + scores.step3 + scores.step4 + scores.step5;
            if(totalScore >= 20) {
                finalTitle.textContent = lang[currentLang].finish_excellent_title;
                finalMessage.textContent = lang[currentLang].finish_excellent_msg;
            } else if (totalScore >= 10) {
                finalTitle.textContent = lang[currentLang].finish_good_title;
                finalMessage.textContent = lang[currentLang].finish_good_msg;
            } else {
                finalTitle.textContent = lang[currentLang].finish_try_again_title;
                finalMessage.textContent = lang[currentLang].finish_try_again_msg;
            }

             finalScore.innerHTML = `
                <p>${lang[currentLang].finish_score_label_step2} <span class="text-gray-800">${scores.step2}</span></p>
                <p>${lang[currentLang].finish_score_label_step3} <span class="text-gray-800">${scores.step3}</span></p>
                <p>${lang[currentLang].finish_score_label_step4} <span class="text-gray-800">${scores.step4}</span></p>
                <p>${lang[currentLang].finish_score_label_step5} <span class="text-gray-800">${scores.step5}</span></p>
                <p class="text-xl mt-2">${lang[currentLang].finish_score_label_total} <span class="text-gray-800">${totalScore}</span></p>
            `;

            updateProgress(6, 'progress_step6');
            switchStep(steps.step5, steps.completion);
        });

        restartBtn.addEventListener('click', () => initializeGame());
        
        setLanguage('en');
        initializeGame();
    });
    </script>
</body>
</html>

