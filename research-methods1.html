<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Process Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7fc;
        }
        .step-card {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .hidden-step {
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            position: absolute;
            pointer-events: none;
        }
        .visible-step {
            opacity: 1;
            transform: translateY(0) scale(1);
            position: static;
            pointer-events: auto;
        }
        .feedback-message {
            transition: all 0.3s ease-in-out;
        }
        /* Fun animation for the mascot */
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .mascot {
            animation: bounce 2s infinite;
        }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake {
          animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 space-y-4 relative">
        
        <!-- Language Selector -->
        <div class="absolute top-4 right-4">
            <select id="languageSelector" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                <option value="en">English</option>
                <option value="zh">‰∏≠Êñá</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>

        <header class="text-center space-y-4 pt-8">
            <div class="flex justify-center items-center gap-3">
                <!-- Mascot -->
                <svg class="w-12 h-12 text-yellow-400 mascot" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a7.5 7.5 0 01-7.5 0c.887.67 2.012.984 3.25.984s2.363-.314 3.25-.984zM6.75 12.75a5.25 5.25 0 017.5 0 .75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.125 0 .25-.008.374-.024a.75.75 0 01.282.282A6.72 6.72 0 0012 21a8.25 8.25 0 01-8.25-8.25 8.25 8.25 0 018.25-8.25c4.545 0 8.25 3.705 8.25 8.25a6.72 6.72 0 00-.543 2.868.75.75 0 01.282-.282A8.962 8.962 0 0021 12c0-4.97-4.03-9-9-9z" />
                </svg>
                <h1 class="text-3xl font-bold text-indigo-600" data-lang-key="title">Research Process Adventure</h1>
            </div>
             <!-- Progress Bar -->
            <div>
                <div id="progressText" class="text-sm text-gray-600 font-medium mb-1" data-lang-key="progress_step1">Step 1 of 3: The Big Question</div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full" style="width: 10%; transition: width 0.5s ease-in-out;"></div>
                </div>
            </div>
        </header>

        <div class="relative">
            <!-- Step 1: Identify the Question -->
            <div id="step1" class="step-card visible-step">
                <div class="p-6 bg-indigo-50 rounded-lg border-2 border-indigo-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step1_heading">Step 1: Identify the Question</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step1_subheading">Good research starts with a great question. Turn a broad topic into a focused one!</p>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700" data-lang-key="step1_topic_label">Here's a broad topic:</label>
                        <p id="topicDisplay" class="mt-1 w-full p-3 bg-gray-100 rounded-md font-semibold text-lg text-gray-900"></p>
                    </div>
                    <div class="mt-4">
                        <label for="researchQuestion" class="block text-sm font-medium text-gray-700" data-lang-key="step1_question_label">Now, make it a specific, researchable question:</label>
                        <textarea id="researchQuestion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" data-lang-key="step1_placeholder" placeholder="e.g., How does playing team-based video games affect teenage communication skills?"></textarea>
                        <p id="questionError" class="text-red-500 text-sm mt-1 hidden" data-lang-key="step1_error">Please write a more specific question (at least 10 characters).</p>
                    </div>
                     <div class="mt-6 text-center">
                        <button id="nextStepBtn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105" data-lang-key="step1_button">
                            Plan My Research &rarr;
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Plan the Research -->
            <div id="step2" class="step-card hidden-step">
                <div class="p-6 bg-teal-50 rounded-lg border-2 border-teal-200">
                    <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="step2_heading">Step 2: Plan the Research</h2>
                    <p class="text-gray-600 mt-2" data-lang-key="step2_subheading">A great plan uses reliable sources. Which would you use to answer your question?</p>
                    
                    <div class="mt-4 p-3 bg-gray-100 rounded-md">
                        <p class="text-sm font-medium text-gray-600" data-lang-key="step2_your_question">Your Question:</p>
                        <p id="questionDisplay" class="font-semibold text-gray-800"></p>
                    </div>

                    <div id="sourceList" class="mt-4 space-y-3">
                        <!-- Sources will be injected here by JS -->
                    </div>

                    <div id="feedback" class="mt-4 p-4 rounded-md text-sm feedback-message hidden"></div>

                    <div class="mt-6 text-center">
                        <button id="checkPlanBtn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105" data-lang-key="step2_button">
                            Check My Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Completion Screen -->
            <div id="completionScreen" class="step-card hidden-step text-center">
                 <div class="p-6 bg-green-50 rounded-lg border-2 border-green-200">
                    <svg class="mx-auto h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 id="finalTitle" class="text-2xl font-semibold text-gray-800 mt-4" data-lang-key="finish_excellent_title">Great Job!</h2>
                    <p id="finalMessage" class="text-gray-600 mt-2" data-lang-key="finish_excellent_msg">You've completed the first two steps. You're on your way to becoming a research expert!</p>
                    <p id="finalScore" class="text-xl font-bold text-indigo-600 mt-4"></p>
                    <div class="mt-6">
                        <button id="restartBtn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105" data-lang-key="finish_button">
                            Play Again
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (DOM element selections remain the same) ...
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const completionScreen = document.getElementById('completionScreen');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            const topicDisplay = document.getElementById('topicDisplay');
            const researchQuestionInput = document.getElementById('researchQuestion');
            const questionDisplay = document.getElementById('questionDisplay');
            const questionError = document.getElementById('questionError');

            const nextStepBtn = document.getElementById('nextStepBtn');
            const checkPlanBtn = document.getElementById('checkPlanBtn');
            const restartBtn = document.getElementById('restartBtn');
            
            const sourceListContainer = document.getElementById('sourceList');
            const feedbackBox = document.getElementById('feedback');
            
            const finalTitle = document.getElementById('finalTitle');
            const finalMessage = document.getElementById('finalMessage');
            const finalScore = document.getElementById('finalScore');
            const languageSelector = document.getElementById('languageSelector');

            const lang = {
                en: {
                    title: "Research Process Adventure",
                    progress_step1: "Step 1 of 3: The Big Question",
                    progress_step2: "Step 2 of 3: The Master Plan",
                    progress_step3: "Complete!",
                    step1_heading: "Step 1: Identify the Question",
                    step1_subheading: "Good research starts with a great question. Turn a broad topic into a focused one!",
                    step1_topic_label: "Here's a broad topic:",
                    step1_question_label: "Now, make it a specific, researchable question:",
                    step1_placeholder: "e.g., How does playing team-based video games affect teenage communication skills?",
                    step1_error: "Please write a more specific question (at least 10 characters).",
                    step1_button: "Plan My Research &rarr;",
                    step2_heading: "Step 2: Plan the Research",
                    step2_subheading: "A great plan uses reliable sources. Which would you use to answer your question?",
                    step2_your_question: "Your Question:",
                    step2_sources_label: "Select your sources:",
                    step2_button: "Check My Plan",
                    step2_button_finish: "Finish! üéâ",
                    feedback_reliable: "‚úîÔ∏è Reliable",
                    feedback_unreliable: "‚ùå Unreliable",
                    finish_excellent_title: "Excellent Work!",
                    finish_excellent_msg: "You've crafted a fantastic research plan with solid sources. You're a natural!",
                    finish_good_title: "Good Job!",
                    finish_good_msg: "You've made a great start! Review the unreliable sources to make your next plan even better.",
                    finish_try_again_title: "Nice Try!",
                    finish_try_again_msg: "That's a start! The best researchers learn from every attempt. Let's try again!",
                    finish_score_label: "Your Plan Score:",
                    finish_button: "Play Again",
                },
                zh: {
                    title: "Á†îÁ©∂ËøáÁ®ãÂ§ßÂÜíÈô©",
                    progress_step1: "Á¨¨1Ê≠•/ÂÖ±3Ê≠•ÔºöÊèêÂá∫ÈáçË¶ÅÈóÆÈ¢ò",
                    progress_step2: "Á¨¨2Ê≠•/ÂÖ±3Ê≠•ÔºöÂà∂ÂÆöÂ§ßÂ∏àËÆ°Âàí",
                    progress_step3: "ÂÆåÊàêÔºÅ",
                    step1_heading: "Á¨¨1Ê≠•ÔºöÁ°ÆÂÆöÈóÆÈ¢ò",
                    step1_subheading: "Â•ΩÁöÑÁ†îÁ©∂Âßã‰∫é‰∏Ä‰∏™Â•ΩÈóÆÈ¢ò„ÄÇÊää‰∏Ä‰∏™ÂÆΩÊ≥õÁöÑËØùÈ¢òÂèòÊàê‰∏Ä‰∏™ÊúâÁÑ¶ÁÇπÁöÑËØùÈ¢òÔºÅ",
                    step1_topic_label: "ËøôÊòØ‰∏Ä‰∏™ÂÆΩÊ≥õÁöÑËØùÈ¢òÔºö",
                    step1_question_label: "Áé∞Âú®ÔºåÊääÂÆÉÂèòÊàê‰∏Ä‰∏™ÂÖ∑‰Ωì„ÄÅÂèØÁ†îÁ©∂ÁöÑÈóÆÈ¢òÔºö",
                    step1_placeholder: "‰æãÂ¶ÇÔºåÁé©Âõ¢ÈòüËßÜÈ¢ëÊ∏∏ÊàèÂ¶Ç‰ΩïÂΩ±ÂìçÈùíÂ∞ëÂπ¥ÁöÑÊ≤üÈÄöÊäÄÂ∑ßÔºü",
                    step1_error: "ËØ∑ËæìÂÖ•‰∏Ä‰∏™Êõ¥ÂÖ∑‰ΩìÁöÑÈóÆÈ¢òÔºàËá≥Â∞ë10‰∏™Â≠óÁ¨¶Ôºâ„ÄÇ",
                    step1_button: "ËÆ°ÂàíÊàëÁöÑÁ†îÁ©∂ &rarr;",
                    step2_heading: "Á¨¨2Ê≠•ÔºöËÆ°ÂàíÁ†îÁ©∂",
                    step2_subheading: "‰∏Ä‰∏™Â•ΩÁöÑËÆ°ÂàíÈúÄË¶Å‰ΩøÁî®ÂèØÈù†ÁöÑÊù•Ê∫ê„ÄÇ‰Ω†‰ºöÁî®Âì™‰∫õÊù•Ê∫êÊù•ÂõûÁ≠î‰Ω†ÁöÑÈóÆÈ¢òÔºü",
                    step2_your_question: "‰Ω†ÁöÑÈóÆÈ¢òÔºö",
                    step2_sources_label: "ÈÄâÊã©‰Ω†ÁöÑÊù•Ê∫êÔºö",
                    step2_button: "Ê£ÄÊü•ÊàëÁöÑËÆ°Âàí",
                    step2_button_finish: "ÂÆåÊàêÔºÅüéâ",
                    feedback_reliable: "‚úîÔ∏è ÂèØÈù†",
                    feedback_unreliable: "‚ùå ‰∏çÂèØÈù†",
                    finish_excellent_title: "ÈùûÂ∏∏Ê£íÔºÅ",
                    finish_excellent_msg: "‰Ω†Âà∂ÂÆö‰∫Ü‰∏Ä‰∏™ÂæàÊ£íÁöÑÁ†îÁ©∂ËÆ°ÂàíÔºåÊù•Ê∫ê‰πüÂæàÂèØÈù†„ÄÇ‰Ω†ÁúüÊòØ‰∏™Â§©ÁîüÁöÑÁ†îÁ©∂ÂëòÔºÅ",
                    finish_good_title: "ÂÅöÂæóÂ•ΩÔºÅ",
                    finish_good_msg: "‰Ω†ÂºÄ‰∫Ü‰∏™Â•ΩÂ§¥ÔºÅÂÜçÁúãÁúãÈÇ£‰∫õ‰∏çÂèØÈù†ÁöÑÊù•Ê∫êÔºåËÆ©‰Ω†ÁöÑ‰∏ã‰∏Ä‰∏™ËÆ°ÂàíÊõ¥ÂÆåÁæé„ÄÇ",
                    finish_try_again_title: "‰∏çÈîôÁöÑÂ∞ùËØïÔºÅ",
                    finish_try_again_msg: "ËøôÊòØ‰∏Ä‰∏™ÂºÄÂßãÔºÅÊúÄÂ•ΩÁöÑÁ†îÁ©∂‰∫∫Âëò‰ªéÊØèÊ¨°Â∞ùËØï‰∏≠Â≠¶‰π†„ÄÇÊàë‰ª¨ÂÜçËØï‰∏ÄÊ¨°ÂêßÔºÅ",
                    finish_score_label: "‰Ω†ÁöÑËÆ°ÂàíÂæóÂàÜÔºö",
                    finish_button: "ÂÜçÁé©‰∏ÄÊ¨°",
                },
                ru: {
                    title: "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≤ –º–∏—Ä –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π",
                    progress_step1: "–®–∞–≥ 1 –∏–∑ 3: –ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å",
                    progress_step2: "–®–∞–≥ 2 –∏–∑ 3: –ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω",
                    progress_step3: "–ó–∞–≤–µ—Ä—à–µ–Ω–æ!",
                    step1_heading: "–®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–æ–ø—Ä–æ—Å",
                    step1_subheading: "–•–æ—Ä–æ—à–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ—Ç–ª–∏—á–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞. –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ —à–∏—Ä–æ–∫—É—é —Ç–µ–º—É –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é!",
                    step1_topic_label: "–í–æ—Ç —à–∏—Ä–æ–∫–∞—è —Ç–µ–º–∞:",
                    step1_question_label: "–¢–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–π—Ç–µ –∏–∑ —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π, –∏—Å—Å–ª–µ–¥—É–µ–º—ã–π –≤–æ–ø—Ä–æ—Å:",
                    step1_placeholder: "–Ω–∞–ø—Ä–∏–º–µ—Ä, –ö–∞–∫ –∫–æ–º–∞–Ω–¥–Ω—ã–µ –≤–∏–¥–µ–æ–∏–≥—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤?",
                    step1_error: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å (–Ω–µ –º–µ–Ω–µ–µ 10 —Å–∏–º–≤–æ–ª–æ–≤).",
                    step1_button: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ &rarr;",
                    step2_heading: "–®–∞–≥ 2: –°–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                    step2_subheading: "–í –æ—Ç–ª–∏—á–Ω–æ–º –ø–ª–∞–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞–¥–µ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏. –ö–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö –≤—ã –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å?",
                    step2_your_question: "–í–∞—à –≤–æ–ø—Ä–æ—Å:",
                    step2_sources_label: "–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:",
                    step2_button: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–π –ø–ª–∞–Ω",
                    step2_button_finish: "–ó–∞–≤–µ—Ä—à–∏—Ç—å! üéâ",
                    feedback_reliable: "‚úîÔ∏è –ù–∞–¥–µ–∂–Ω—ã–π",
                    feedback_unreliable: "‚ùå –ù–µ–Ω–∞–¥–µ–∂–Ω—ã–π",
                    finish_excellent_title: "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
                    finish_excellent_msg: "–í—ã —Å–æ—Å—Ç–∞–≤–∏–ª–∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å –Ω–∞–¥–µ–∂–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏. –£ –≤–∞—Å —Ç–∞–ª–∞–Ω—Ç!",
                    finish_good_title: "–•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞!",
                    finish_good_msg: "–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ! –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω –µ—â–µ –ª—É—á—à–µ.",
                    finish_try_again_title: "–ù–µ–ø–ª–æ—Ö–∞—è –ø–æ–ø—ã—Ç–∫–∞!",
                    finish_try_again_msg: "–≠—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ! –õ—É—á—à–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ —É—á–∞—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–µ. –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑!",
                    finish_score_label: "–í–∞—à —Å—á–µ—Ç –∑–∞ –ø–ª–∞–Ω:",
                    finish_button: "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞",
                }
            };

            const topics = {
                en: ["The impact of video games on teenagers", "Climate change and its effect on polar bears", "The history of the internet", "Healthy eating habits for students", "The rise of social media influencers"],
                zh: ["ÁîµÂ≠êÊ∏∏ÊàèÂØπÈùíÂ∞ëÂπ¥ÁöÑÂΩ±Âìç", "Ê∞îÂÄôÂèòÂåñÂèäÂÖ∂ÂØπÂåóÊûÅÁÜäÁöÑÂΩ±Âìç", "‰∫íËÅîÁΩëÁöÑÂéÜÂè≤", "Â≠¶ÁîüÁöÑÂÅ•Â∫∑È•ÆÈ£ü‰π†ÊÉØ", "Á§æ‰∫§Â™í‰ΩìÂΩ±ÂìçËÄÖÁöÑÂ¥õËµ∑"],
                ru: ["–í–ª–∏—è–Ω–∏–µ –≤–∏–¥–µ–æ–∏–≥—Ä –Ω–∞ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤", "–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞ –∏ –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –±–µ–ª—ã—Ö –º–µ–¥–≤–µ–¥–µ–π", "–ò—Å—Ç–æ—Ä–∏—è –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞", "–ü—Ä–∏–≤—ã—á–∫–∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤", "–†–æ—Å—Ç –≤–ª–∏—è–Ω–∏—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö"]
            };

            const sources = {
                en: [{ name: "Scholarly Journals (e.g., JSTOR)", reliable: true }, { name: "Government Reports (e.g., NASA, WHO)", reliable: true }, { name: "Reputable News Organizations (e.g., BBC, AP)", reliable: true }, { name: "Books by recognized experts", reliable: true }, { name: "Wikipedia", reliable: false }, { name: "Personal Blogs", reliable: false }, { name: "Social Media Posts", reliable: false }],
                zh: [{ name: "Â≠¶ÊúØÊúüÂàä (‰æãÂ¶Ç, JSTOR)", reliable: true }, { name: "ÊîøÂ∫úÊä•Âëä (‰æãÂ¶Ç, NASA, WHO)", reliable: true }, { name: "‰ø°Ë™âËâØÂ•ΩÁöÑÊñ∞ÈóªÊú∫ÊûÑ (‰æãÂ¶Ç, BBC, AP)", reliable: true }, { name: "Áü•Âêç‰∏ìÂÆ∂ÁöÑ‰π¶Á±ç", reliable: true }, { name: "Áª¥Âü∫ÁôæÁßë", reliable: false }, { name: "‰∏™‰∫∫ÂçöÂÆ¢", reliable: false }, { name: "Á§æ‰∫§Â™í‰ΩìÂ∏ñÂ≠ê", reliable: false }],
                ru: [{ name: "–ù–∞—É—á–Ω—ã–µ –∂—É—Ä–Ω–∞–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSTOR)", reliable: true }, { name: "–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, NASA, WHO)", reliable: true }, { name: "–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, BBC, AP)", reliable: true }, { name: "–ö–Ω–∏–≥–∏ –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤", reliable: true }, { name: "–í–∏–∫–∏–ø–µ–¥–∏—è", reliable: false }, { name: "–õ–∏—á–Ω—ã–µ –±–ª–æ–≥–∏", reliable: false }, { name: "–ü–æ—Å—Ç—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö", reliable: false }]
            };
            
            let currentLang = 'en';

            function setLanguage(langCode) {
                currentLang = langCode;
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.getAttribute('data-lang-key');
                    if (lang[langCode][key]) {
                        if (el.tagName === 'TEXTAREA') {
                           el.placeholder = lang[langCode][key];
                        } else {
                           el.innerHTML = lang[langCode][key];
                        }
                    }
                });
            }

            languageSelector.addEventListener('change', (e) => {
                setLanguage(e.target.value);
                initializeGame(true); // Re-initialize to update topic and sources language
            });


            function updateProgress(step, textKey) {
                const percentage = { 1: 10, 2: 50, 3: 100 };
                progressBar.style.width = `${percentage[step]}%`;
                progressText.textContent = lang[currentLang][textKey];
            }

            function initializeGame(languageChange = false) {
                if (!languageChange) {
                    updateProgress(1, 'progress_step1');
                    switchStep(completionScreen, step1, true);
                }

                researchQuestionInput.value = '';
                feedbackBox.classList.add('hidden');
                checkPlanBtn.textContent = lang[currentLang].step2_button;
                checkPlanBtn.disabled = false;
                checkPlanBtn.onclick = handleCheckPlan;

                const randomTopic = topics[currentLang][Math.floor(Math.random() * topics[currentLang].length)];
                topicDisplay.textContent = randomTopic;

                sourceListContainer.innerHTML = `<p class="font-medium text-gray-700" data-lang-key="step2_sources_label">${lang[currentLang].step2_sources_label}</p>`;
                sources[currentLang].forEach((source, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-3 bg-white rounded-md border hover:border-indigo-300 transition-all';
                    div.innerHTML = `
                        <div class="flex items-center">
                            <input id="source-${index}" name="sources" type="checkbox" data-reliable="${source.reliable}" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <label for="source-${index}" class="ml-3 block text-sm font-medium text-gray-800">${source.name}</label>
                        </div>
                        <div id="feedback-${index}" class="text-sm font-bold ml-4 opacity-0 transition-opacity"></div>
                    `;
                    sourceListContainer.appendChild(div);
                });
            }
            
            function switchStep(from, to, isInstant = false) {
                from.classList.remove('visible-step');
                from.classList.add('hidden-step');
                
                const delay = isInstant ? 0 : 500;

                setTimeout(() => {
                    to.classList.remove('hidden-step');
                    to.classList.add('visible-step');
                }, delay);
            }

            nextStepBtn.addEventListener('click', () => {
                const userQuestion = researchQuestionInput.value.trim();
                questionError.classList.add('hidden');
                researchQuestionInput.classList.remove('shake');

                if (userQuestion.length < 10) {
                    questionError.classList.remove('hidden');
                    researchQuestionInput.classList.add('shake');
                    return;
                }
                questionDisplay.textContent = userQuestion;
                updateProgress(2, 'progress_step2');
                switchStep(step1, step2);
            });
            
            function handleCheckPlan() {
                const checkboxes = sourceListContainer.querySelectorAll('input[type="checkbox"]');
                let correctSelections = 0;
                let incorrectSelections = 0;
                let totalCorrect = sources[currentLang].filter(s => s.reliable).length;
                
                checkboxes.forEach((checkbox, index) => {
                    const isReliable = checkbox.dataset.reliable === 'true';
                    const feedbackEl = document.getElementById(`feedback-${index}`);
                    
                    if (checkbox.checked) {
                        if (isReliable) {
                            correctSelections++;
                            feedbackEl.innerHTML = `<span class="text-green-600">${lang[currentLang].feedback_reliable}</span>`;
                        } else {
                            incorrectSelections++;
                            feedbackEl.innerHTML = `<span class="text-red-600">${lang[currentLang].feedback_unreliable}</span>`;
                        }
                        feedbackEl.classList.remove('opacity-0');
                    }
                    checkbox.disabled = true; // Disable after checking
                });

                let score = Math.max(0, (correctSelections * 2) - incorrectSelections);
                let scorePercentage = totalCorrect > 0 ? (correctSelections / totalCorrect) * 100 : 0;
                
                if(scorePercentage >= 75) {
                    finalTitle.textContent = lang[currentLang].finish_excellent_title;
                    finalMessage.textContent = lang[currentLang].finish_excellent_msg;
                } else if (scorePercentage >= 50) {
                    finalTitle.textContent = lang[currentLang].finish_good_title;
                    finalMessage.textContent = lang[currentLang].finish_good_msg;
                } else {
                    finalTitle.textContent = lang[currentLang].finish_try_again_title;
                    finalMessage.textContent = lang[currentLang].finish_try_again_msg;
                }
                
                finalScore.textContent = `${lang[currentLang].finish_score_label} ${score}`;

                checkPlanBtn.textContent = lang[currentLang].step2_button_finish;
                checkPlanBtn.onclick = () => {
                    updateProgress(3, 'progress_step3');
                    switchStep(step2, completionScreen);
                };
            }

            restartBtn.addEventListener('click', () => initializeGame());
            
            // Initial setup
            setLanguage('en');
            initializeGame();
        });
    </script>
</body>
</html>

