<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paraphrase Relay Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease-in-out;
            border: 1px solid #e5e7eb;
        }
        .btn {
            display: inline-block;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            cursor: pointer;
            text-align: center;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .btn-wacky {
            background-color: #ec4899;
            color: white;
        }
        .btn-wacky:hover {
            background-color: #db2777;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
        }
        textarea {
            resize: none;
        }
        .hidden {
            display: none;
        }
        /* Toggle Switch */
        .toggle-label {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle-label input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #ec4899;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        /* Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ec4899;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto 0;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-2xl mx-auto">
        <!-- Start Screen -->
        <div id="start-screen" class="card text-center">
            <svg class="w-16 h-16 mx-auto mb-4 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
            </svg>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Paraphrase Relay</h1>
            <p class="text-lg text-gray-600 mb-6">A game about paraphrasing, inspired by the classic Telephone Game.</p>
            <p class="mb-8 text-gray-700">Just like in the Telephone Game, a message is passed from person to person. But here, you'll be paraphrasing! The goal is to keep the original meaning of the sentence intact. This shows why it's so important to understand an idea fully before you put it in your own words.</p>
            <button id="start-game-btn" class="btn btn-primary w-full sm:w-auto">Let's Play!</button>
        </div>

        <!-- Setup Screen -->
        <div id="setup-screen" class="card text-center hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Game Setup</h2>
            <div class="mb-6">
                <label for="player-count" class="block text-lg text-gray-700 mb-2">How many students are in the relay?</label>
                <div class="flex items-center justify-center space-x-4">
                    <span class="text-xl font-semibold text-indigo-600">3</span>
                    <input id="player-count" type="range" min="3" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <span class="text-xl font-semibold text-indigo-600">20</span>
                </div>
                <p class="mt-4 text-5xl font-bold text-gray-800"><span id="player-count-display">5</span></p>
            </div>
             <div class="mb-8 flex justify-center items-center space-x-4">
                <span id="normal-mode-label" class="text-lg text-gray-700 font-semibold">Normal Mode</span>
                <label class="toggle-label">
                    <input type="checkbox" id="wacky-mode-toggle">
                    <span class="slider"></span>
                </label>
                <span id="wacky-mode-label" class="text-lg text-gray-500 font-semibold">Wacky Mode</span>
            </div>
            <button id="begin-relay-btn" class="btn btn-primary w-full sm:w-auto">Begin Relay</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="card hidden">
            <div class="text-center mb-6">
                 <h2 id="player-turn" class="text-3xl font-bold text-gray-800">Student 1's Turn</h2>
                 <p id="instruction" class="text-gray-600 mt-1">Read the sentence below and paraphrase it.</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl mb-4 border border-gray-200">
                <p class="text-sm font-semibold text-gray-500 mb-2" id="original-label">Original Sentence:</p>
                <p id="sentence-to-paraphrase" class="text-lg text-gray-800"></p>
            </div>
            <div>
                 <label for="paraphrase-input" class="block text-sm font-semibold text-gray-700 mb-2">Your Paraphrase:</label>
                 <textarea id="paraphrase-input" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                 <p id="error-message" class="text-red-500 text-sm mt-2 hidden">Please enter a paraphrase.</p>
            </div>
            <button id="submit-paraphrase-btn" class="btn btn-primary w-full mt-6">Pass it on!</button>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="card hidden">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">How did the message change?</h2>
            <div class="space-y-6">
                <div>
                    <h3 class="font-bold text-lg text-gray-700 mb-2">Original Sentence:</h3>
                    <div class="bg-green-50 text-green-800 p-4 rounded-xl border border-green-200">
                        <p id="final-original" class="text-lg"></p>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-gray-700 mb-2">The Chain of Paraphrases:</h3>
                    <div id="paraphrase-chain" class="space-y-2"></div>
                </div>
                 <div>
                    <h3 class="font-bold text-lg text-gray-700 mb-2">Final Message:</h3>
                    <div class="bg-red-50 text-red-800 p-4 rounded-xl border border-red-200">
                        <p id="final-message" class="text-lg"></p>
                    </div>
                </div>
                 <div id="wacky-twist-container" class="text-center pt-4 border-t border-gray-200">
                    <button id="wacky-twist-btn" class="btn btn-wacky">Get a Wacky Twist!</button>
                    <div id="wacky-result-box" class="hidden mt-4">
                         <h3 class="font-bold text-lg text-pink-600 mb-2">AI-Generated Wacky Twist:</h3>
                         <div class="bg-pink-50 text-pink-800 p-4 rounded-xl border border-pink-200">
                             <p id="wacky-result-text" class="text-lg"></p>
                         </div>
                    </div>
                    <div id="wacky-loader" class="loader hidden"></div>
                </div>
            </div>
            <div class="text-center mt-8">
                <button id="play-again-btn" class="btn btn-primary w-full sm:w-auto">Play Again</button>
            </div>
        </div>

    </div>

    <script>
        const sentences = [
            "Global warming causes glaciers to melt and raises sea levels.",
            "Reading improves your imagination and vocabulary.",
            "Using too much plastic harms marine animals.",
            "The internet connects people around the world.",
            "Eating fruits and vegetables keeps your body healthy.",
            "Exercise helps people stay healthy by strengthening the heart and muscles."
        ];

        const wackySentences = [
            "A herd of singing penguins is planning to launch a musical on Mars.",
            "My toaster has started giving me questionable life advice every morning.",
            "The moon is actually a giant disco ball that only turns on when we're asleep.",
            "If you whisper a secret to a potato, it will grow extra eyes to watch over it.",
            "Squirrels are secretly training pigeons to become an elite air force.",
            "A detective discovered that all missing left socks are teleporting to a sock-only dimension."
        ];

        let availableSentences = [...sentences];
        let playerCount = 5;
        let currentPlayer = 1;
        let originalSentence = '';
        let paraphraseHistory = [];
        let isWackyMode = false;

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        
        const startGameBtn = document.getElementById('start-game-btn');
        const beginRelayBtn = document.getElementById('begin-relay-btn');
        const submitParaphraseBtn = document.getElementById('submit-paraphrase-btn');
        const playAgainBtn = document.getElementById('play-again-btn');

        const playerCountSlider = document.getElementById('player-count');
        const playerCountDisplay = document.getElementById('player-count-display');
        const wackyModeToggle = document.getElementById('wacky-mode-toggle');
        const normalModeLabel = document.getElementById('normal-mode-label');
        const wackyModeLabel = document.getElementById('wacky-mode-label');
        
        const playerTurn = document.getElementById('player-turn');
        const instruction = document.getElementById('instruction');
        const originalLabel = document.getElementById('original-label');
        const sentenceToParaphrase = document.getElementById('sentence-to-paraphrase');
        const paraphraseInput = document.getElementById('paraphrase-input');
        const errorMessage = document.getElementById('error-message');

        const finalOriginal = document.getElementById('final-original');
        const paraphraseChain = document.getElementById('paraphrase-chain');
        const finalMessage = document.getElementById('final-message');
        
        const wackyTwistContainer = document.getElementById('wacky-twist-container');
        const wackyTwistBtn = document.getElementById('wacky-twist-btn');
        const wackyResultBox = document.getElementById('wacky-result-box');
        const wackyResultText = document.getElementById('wacky-result-text');
        const wackyLoader = document.getElementById('wacky-loader');

        // Event Listeners
        startGameBtn.addEventListener('click', () => showScreen('setup-screen'));
        
        playerCountSlider.addEventListener('input', (e) => {
            playerCountDisplay.textContent = e.target.value;
            playerCount = parseInt(e.target.value);
        });

        wackyModeToggle.addEventListener('change', (e) => {
            isWackyMode = e.target.checked;
            if (isWackyMode) {
                wackyModeLabel.classList.remove('text-gray-500');
                wackyModeLabel.classList.add('text-pink-600');
                normalModeLabel.classList.remove('text-gray-700');
                normalModeLabel.classList.add('text-gray-500');
                beginRelayBtn.classList.remove('btn-primary');
                beginRelayBtn.classList.add('btn-wacky');
            } else {
                wackyModeLabel.classList.add('text-gray-500');
                wackyModeLabel.classList.remove('text-pink-600');
                normalModeLabel.classList.add('text-gray-700');
                normalModeLabel.classList.remove('text-gray-500');
                beginRelayBtn.classList.add('btn-primary');
                beginRelayBtn.classList.remove('btn-wacky');
            }
        });
        
        beginRelayBtn.addEventListener('click', startGame);
        
        submitParaphraseBtn.addEventListener('click', () => {
            const currentParaphrase = paraphraseInput.value.trim();
            if (currentParaphrase === '') {
                errorMessage.classList.remove('hidden');
                return;
            }
            errorMessage.classList.add('hidden');
            
            paraphraseHistory.push(currentParaphrase);
            paraphraseInput.value = '';

            if (currentPlayer < playerCount) {
                currentPlayer++;
                updateGameScreen();
            } else {
                showResults();
            }
        });
        
        playAgainBtn.addEventListener('click', () => {
             showScreen('setup-screen');
             resetGame();
        });
        
        wackyTwistBtn.addEventListener('click', getWackyTwist);

        // Functions
        function showScreen(screenId) {
            [startScreen, setupScreen, gameScreen, resultsScreen].forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        function getRandomSentence() {
            const sourceArray = isWackyMode ? wackySentences : sentences;
            if (availableSentences.length === 0) {
                availableSentences = [...sourceArray];
            }
            const randomIndex = Math.floor(Math.random() * availableSentences.length);
            return availableSentences.splice(randomIndex, 1)[0];
        }

        function startGame() {
            resetGame();
            availableSentences = isWackyMode ? [...wackySentences] : [...sentences];
            originalSentence = getRandomSentence();
            showScreen('game-screen');
            updateGameScreen();
        }
        
        function updateGameScreen() {
            playerTurn.textContent = `Student ${currentPlayer}'s Turn`;
            if (currentPlayer === 1) {
                originalLabel.textContent = 'Original Sentence:';
                instruction.textContent = 'Read the sentence below and write your paraphrase.';
                sentenceToParaphrase.textContent = originalSentence;
            } else {
                originalLabel.textContent = `Student ${currentPlayer - 1}'s Paraphrase:`;
                instruction.textContent = `Read the paraphrase below and write your own version of it.`;
                sentenceToParaphrase.textContent = paraphraseHistory[paraphraseHistory.length - 1];
            }
        }
        
        function showResults() {
            finalOriginal.textContent = originalSentence;
            finalMessage.textContent = paraphraseHistory[paraphraseHistory.length - 1];
            
            paraphraseChain.innerHTML = '';
            paraphraseHistory.forEach((phrase, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'p-3 bg-gray-100 rounded-lg border';
                stepElement.innerHTML = `<p><span class="font-semibold">Student ${index + 1}:</span> ${phrase}</p>`;
                paraphraseChain.appendChild(stepElement);
            });
            
            wackyTwistContainer.classList.toggle('hidden', !isWackyMode);
            showScreen('results-screen');
        }

        function resetGame() {
            currentPlayer = 1;
            originalSentence = '';
            paraphraseHistory = [];
            paraphraseInput.value = '';
            errorMessage.classList.add('hidden');
            wackyResultBox.classList.add('hidden');
            wackyTwistBtn.classList.remove('hidden');
            wackyLoader.classList.add('hidden');
        }
        
        async function getWackyTwist() {
            wackyTwistBtn.classList.add('hidden');
            wackyLoader.classList.remove('hidden');

            const finalSentence = finalMessage.textContent;
            const userQuery = `The following sentence is the result of a telephone game: "${finalSentence}". Rewrite it into a single, short, funny, and completely absurd new sentence.`;
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                    })
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                let wackyText = "Couldn't think of anything wacky enough! Try again.";

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    wackyText = candidate.content.parts[0].text;
                }
                
                wackyResultText.textContent = wackyText;

            } catch (error) {
                console.error("Error fetching wacky twist:", error);
                wackyResultText.textContent = "My wacky idea generator is snoozing. Please try again!";
            } finally {
                wackyLoader.classList.add('hidden');
                wackyResultBox.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>

