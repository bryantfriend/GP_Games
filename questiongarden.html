<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inquiry Garden: Seeds of Perspective</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F4F8;
            background-image: radial-gradient(#CFD8DC 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .plant-part {
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            opacity: 0;
            transform-origin: bottom center;
        }
        .plot:hover .plot-bg {
            transform: scale(1.05);
        }
        .plot-bg {
            transition: transform 0.2s ease-in-out;
        }
        .seed-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background-color: #38A169; /* Green-600 */
        }
        .btn-primary:hover {
            background-color: #2F855A; /* Green-700 */
        }
        .notification {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            transform: translateY(100%);
            opacity: 0;
        }
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Main Game Container -->
    <div id="game-container" class="min-h-screen flex flex-col items-center p-4 md:p-8">

        <!-- Header -->
        <header class="w-full max-w-6xl flex justify-between items-center bg-white/70 backdrop-blur-sm p-4 rounded-xl shadow-md border border-gray-200 mb-8">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-700">Inquiry Garden</h1>
                <p class="text-sm md:text-base text-gray-500">Cultivate curiosity, grow perspective.</p>
            </div>
            <div id="ip-counter" class="text-right">
                <p class="text-xl md:text-2xl font-bold text-green-600">100 IP</p>
                <span class="text-xs text-gray-500">Insight Points</span>
            </div>
        </header>

        <!-- Garden Area -->
        <main id="garden-area" class="w-full max-w-6xl grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8 flex-grow">
            <!-- Garden plots will be generated by JS -->
        </main>

        <!-- Footer UI Buttons -->
        <footer class="w-full max-w-6xl flex justify-center items-center gap-4 mt-8">
            <button onclick="openModal('seedShedModal')" class="bg-yellow-800 hover:bg-yellow-900 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                ðŸŒ± Seed Shed
            </button>
            <button onclick="openModal('almanacModal')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                ðŸ“š Almanac
            </button>
        </footer>
    </div>

    <!-- Seed Shed Modal -->
    <div id="seedShedModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden" onclick="closeModal('seedShedModal')">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">Seed Shed</h2>
                <button onclick="closeModal('seedShedModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <p class="text-gray-600 mb-6">Select a "Topic Seed" to plant. More complex topics yield more Insight Points.</p>
            <div id="seed-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Seed options will be generated by JS -->
            </div>
        </div>
    </div>

    <!-- Question Crafter Modal -->
    <div id="questionCrafterModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 transform scale-95">
             <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">Nurture with Inquiry</h2>
                <button onclick="closeModal('questionCrafterModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <p class="text-gray-600 mb-2">Craft a question for: <strong id="qc-topic-name" class="text-green-700"></strong></p>
            <p class="text-sm text-gray-500 mb-6">Combine elements to form a powerful question. The more complex, the better the growth!</p>
            
            <div class="space-y-4">
                <div>
                    <label for="qc-stem" class="block text-sm font-medium text-gray-700 mb-1">1. Question Stem</label>
                    <select id="qc-stem" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                </div>
                <div>
                    <label for="qc-concept1" class="block text-sm font-medium text-gray-700 mb-1">2. Core Concept</label>
                    <select id="qc-concept1" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                </div>
                <div>
                    <label for="qc-connector" class="block text-sm font-medium text-gray-700 mb-1">3. Connecting Phrase</label>
                    <select id="qc-connector" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                </div>
                <div>
                    <label for="qc-stakeholder" class="block text-sm font-medium text-gray-700 mb-1">4. Stakeholder / Second Concept</label>
                    <select id="qc-stakeholder" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                </div>
            </div>
            <div class="mt-8 flex justify-end">
                <button onclick="submitQuestion()" class="btn-primary text-white font-bold py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition">Nurture Plant</button>
            </div>
        </div>
    </div>
    
    <!-- Almanac Modal -->
    <div id="almanacModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden" onclick="closeModal('almanacModal')">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h2 class="text-2xl font-bold">Almanac</h2>
                <button onclick="closeModal('almanacModal')" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <p class="text-gray-600 mb-6">Use your Insight Points to unlock new plots and expand your garden.</p>
            <div id="almanac-items">
                 <!-- Almanac items will be generated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Notification System -->
    <div id="notification" class="notification fixed bottom-4 right-4 bg-gray-800 text-white p-4 rounded-lg shadow-xl max-w-sm">
        <h3 id="notification-title" class="font-bold">Notification</h3>
        <p id="notification-message">This is a test.</p>
    </div>

    <script>
        // --- GAME DATA ---
        const SEED_DATA = {
            's1': { 
                name: 'Local Water Use', 
                cost: 0, 
                maxGrowth: 100, 
                harvestBonus: 150,
                stems: [
                    { text: 'What is...', value: 1, quality: 'basic' },
                    { text: 'Where does...', value: 2, quality: 'basic' },
                    { text: 'Why is...', value: 5, quality: 'good' },
                    { text: 'How does...', value: 8, quality: 'good' },
                ],
                concepts: [
                    { text: 'the source of our water', value: 2, quality: 'basic' },
                    { text: 'water conservation', value: 5, quality: 'good' },
                    { text: 'the effect of pollution', value: 8, quality: 'excellent' },
                ],
                stakeholders: [
                    { text: 'local residents', value: 3, quality: 'basic' },
                    { text: 'the city council', value: 5, quality: 'good' },
                    { text: 'nearby factories', value: 7, quality: 'good' },
                    { text: 'the local ecosystem', value: 10, quality: 'excellent' },
                ]
            },
            's2': { 
                name: 'Fast Fashion', 
                cost: 150, 
                maxGrowth: 150, 
                harvestBonus: 300,
                stems: [
                    { text: 'What is...', value: 1, quality: 'basic' },
                    { text: 'How does...', value: 5, quality: 'good' },
                    { text: 'What are the consequences of...', value: 8, quality: 'excellent' },
                    { text: 'To what extent does...', value: 12, quality: 'excellent' },
                ],
                concepts: [
                    { text: 'the clothing production process', value: 3, quality: 'basic' },
                    { text: 'the environmental impact', value: 6, quality: 'good' },
                    { text: 'labor practices', value: 9, quality: 'excellent' },
                    { text: 'consumer behavior', value: 10, quality: 'excellent' },
                ],
                stakeholders: [
                    { text: 'brand executives', value: 4, quality: 'good' },
                    { text: 'garment workers', value: 8, quality: 'excellent' },
                    { text: 'environmental activists', value: 8, quality: 'excellent' },
                    { text: 'shoppers', value: 6, quality: 'good' },
                ]
            },
            's3': { 
                name: 'Global Supply Chains', 
                cost: 300, 
                maxGrowth: 200, 
                harvestBonus: 500,
                stems: [
                    { text: 'How are...', value: 5, quality: 'good' },
                    { text: 'What is the relationship between...', value: 8, quality: 'good' },
                    { text: 'How do geopolitical events affect...', value: 12, quality: 'excellent' },
                    { text: 'To what extent are... dependent on...', value: 15, quality: 'excellent' },
                ],
                concepts: [
                    { text: 'manufacturing centers', value: 4, quality: 'good' },
                    { text: 'shipping and logistics', value: 7, quality: 'good' },
                    { text: 'trade policies', value: 10, quality: 'excellent' },
                    { text: 'ethical sourcing', value: 13, quality: 'excellent' },
                ],
                stakeholders: [
                    { text: 'transnational corporations', value: 6, quality: 'good' },
                    { text: 'factory workers', value: 8, quality: 'excellent' },
                    { text: 'end consumers', value: 5, quality: 'good' },
                    { text: 'national governments', value: 9, quality: 'excellent' },
                ]
            },
        };

        const CONNECTING_PHRASES = [
            { text: 'affect...', value: 2, quality: 'good' },
            { text: 'relate to...', value: 1, quality: 'basic' },
            { text: 'create challenges for...', value: 4, quality: 'good' },
            { text: 'outweigh the benefits for...', value: 6, quality: 'excellent' }
        ];

        const ALMANAC_DATA = [
            { id: 'plot_5', name: 'Unlock 5th Plot', cost: 200, type: 'plot' },
            { id: 'plot_6', name: 'Unlock 6th Plot', cost: 350, type: 'plot' },
        ];

        // --- GAME STATE ---
        let gameState = {
            insightPoints: 100,
            plots: [
                { id: 1, seedId: null, growth: 0 },
                { id: 2, seedId: null, growth: 0 },
                { id: 3, seedId: null, growth: 0 },
                { id: 4, seedId: null, growth: 0 },
            ],
            unlockedSeeds: ['s1'],
            unlockedAlmanacItems: [],
            plantingSeedId: null,
            activePlotId: null
        };
        
        // --- DOM ELEMENTS ---
        const ipCounter = document.getElementById('ip-counter');
        const gardenArea = document.getElementById('garden-area');
        const seedOptions = document.getElementById('seed-options');
        const almanacItems = document.getElementById('almanac-items');

        // --- RENDERING FUNCTIONS ---

        function renderAll() {
            renderIP();
            renderPlots();
            renderSeedShed();
            renderAlmanac();
        }
        
        function renderIP() {
            ipCounter.innerHTML = `
                <p class="text-xl md:text-2xl font-bold text-green-600">${gameState.insightPoints} IP</p>
                <span class="text-xs text-gray-500">Insight Points</span>
            `;
        }

        function renderPlots() {
            gardenArea.innerHTML = '';
            gameState.plots.forEach(plot => {
                const plotElement = document.createElement('div');
                plotElement.className = 'plot relative aspect-square flex items-center justify-center cursor-pointer group';
                plotElement.onclick = () => onPlotClick(plot.id);

                let content = `
                    <div class="plot-bg absolute inset-0 bg-yellow-900/60 rounded-full group-hover:bg-yellow-900/80 transition-all"></div>
                    <div class="absolute inset-2 bg-yellow-800 rounded-full"></div>
                `;

                if (plot.seedId) {
                    const seed = SEED_DATA[plot.seedId];
                    const growthPercentage = Math.min((plot.growth / seed.maxGrowth) * 100, 100);
                    const canHarvest = growthPercentage >= 100;
                    
                    content += `
                        <div class="relative w-full h-full flex items-end justify-center">
                            ${getPlantSVG(growthPercentage)}
                        </div>
                        <div class="absolute top-2 right-2 bg-white/80 text-xs px-2 py-1 rounded-full">${seed.name}</div>
                    `;
                    if (canHarvest) {
                         content += `
                            <div class="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center">
                                <button onclick="event.stopPropagation(); harvestPlant(${plot.id})" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-xl">Harvest</button>
                            </div>
                        `;
                    }
                } else {
                     content += `<div class="absolute text-5xl text-yellow-600 opacity-50 group-hover:opacity-80 transition">+</div>`;
                }
                plotElement.innerHTML = content;
                gardenArea.appendChild(plotElement);
            });
        }

        function renderSeedShed() {
            seedOptions.innerHTML = '';
            Object.keys(SEED_DATA).forEach(seedId => {
                const seed = SEED_DATA[seedId];
                const isUnlocked = gameState.unlockedSeeds.includes(seedId);
                const canAfford = gameState.insightPoints >= seed.cost;

                const seedCard = document.createElement('div');
                seedCard.className = `seed-card p-4 border rounded-lg transition ${isUnlocked || canAfford ? 'cursor-pointer' : 'bg-gray-200 opacity-70'}`;

                if (isUnlocked) {
                   seedCard.onclick = () => selectSeedToPlant(seedId);
                   seedCard.classList.add('bg-green-50', 'hover:bg-green-100');
                } else if (canAfford) {
                   seedCard.onclick = () => selectSeedToPlant(seedId);
                   seedCard.classList.add('bg-white', 'hover:bg-gray-50');
                }

                seedCard.innerHTML = `
                    <h3 class="font-bold text-lg">${seed.name}</h3>
                    <p class="text-sm text-gray-600">Max Growth: ${seed.maxGrowth} | Harvest: ${seed.harvestBonus} IP</p>
                    <div class="mt-2 text-right font-semibold ${isUnlocked ? 'text-green-600' : (canAfford ? 'text-blue-600' : 'text-gray-500')}">
                        ${isUnlocked ? 'UNLOCKED' : `Unlock for ${seed.cost} IP`}
                    </div>
                `;
                seedOptions.appendChild(seedCard);
            });
        }
        
        function renderAlmanac() {
            almanacItems.innerHTML = '';
            ALMANAC_DATA.forEach(item => {
                const isUnlocked = gameState.unlockedAlmanacItems.includes(item.id);
                const canAfford = gameState.insightPoints >= item.cost;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'p-3 border rounded-lg flex justify-between items-center';
                itemDiv.innerHTML = `
                    <div>
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-gray-500">${item.cost} IP</p>
                    </div>
                    <button class="px-4 py-2 text-sm font-semibold rounded-md ${isUnlocked ? 'bg-gray-300 text-gray-600' : (canAfford ? 'bg-blue-500 hover:bg-blue-600 text-white' : 'bg-gray-300 text-gray-600')}"
                        ${isUnlocked || !canAfford ? 'disabled' : ''}
                        onclick="buyAlmanacItem('${item.id}')">
                        ${isUnlocked ? 'Unlocked' : 'Buy'}
                    </button>
                `;
                almanacItems.appendChild(itemDiv);
            });
        }
        
        function getPlantSVG(growth) {
            // This function returns an SVG string with parts visible based on growth percentage.
            const p = (val) => growth >= val; // predicate
            return `
                <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-lg">
                    <!-- Stage 1: Sprout (0-20%) -->
                    <path d="M 50 90 C 50 80, 45 75, 52 70" stroke="#689F38" fill="none" stroke-width="3" class="plant-part" style="opacity: ${p(1) ? 1:0};" />
                    <!-- Stage 2: Stem (20-40%) -->
                    <path d="M 50 90 V 50" stroke="#558B2F" fill="none" stroke-width="4" class="plant-part" style="opacity: ${p(20) ? 1:0};" />
                    <!-- Stage 3: First Leaves (40-60%) -->
                    <path d="M 50 70 C 40 65, 30 75, 40 80" fill="#7CB342" class="plant-part" style="opacity: ${p(40) ? 1:0}; transform: rotate(10deg);" />
                    <path d="M 50 65 C 60 60, 70 70, 60 75" fill="#7CB342" class="plant-part" style="opacity: ${p(50) ? 1:0}; transform: rotate(-10deg);" />
                    <!-- Stage 4: More Growth (60-80%) -->
                     <path d="M 50 50 V 30" stroke="#4CAF50" fill="none" stroke-width="3.5" class="plant-part" style="opacity: ${p(60) ? 1:0};" />
                    <path d="M 50 55 C 40 50, 30 60, 40 65" fill="#8BC34A" class="plant-part" style="opacity: ${p(75) ? 1:0}; transform: rotate(15deg);" />
                     <!-- Stage 5: Flower (80-100%) -->
                    <circle cx="50" cy="25" r="10" fill="#FBC02D" class="plant-part" style="opacity: ${p(80) ? 1:0}; transform: scale(${Math.min(1, (growth - 80) / 20 * 1.5)})" />
                    <circle cx="50" cy="25" r="5" fill="#F57F17" class="plant-part" style="opacity: ${p(95) ? 1:0};" />
                </svg>
            `;
        }

        // --- GAME LOGIC FUNCTIONS ---
        
        function onPlotClick(plotId) {
            const plot = gameState.plots.find(p => p.id === plotId);
            if (!plot.seedId && gameState.plantingSeedId) {
                // Plant the selected seed
                plot.seedId = gameState.plantingSeedId;
                plot.growth = 1;
                gameState.plantingSeedId = null;
                document.body.style.cursor = 'default';
                showNotification('Seed Planted!', `Your ${SEED_DATA[plot.seedId].name} seed has sprouted.`);
                renderPlots();
            } else if (plot.seedId) {
                // Open question crafter
                const growthPercentage = (plot.growth / SEED_DATA[plot.seedId].maxGrowth) * 100;
                if(growthPercentage < 100) {
                    openQuestionCrafter(plotId);
                }
            }
        }
        
        function selectSeedToPlant(seedId) {
            const seed = SEED_DATA[seedId];
            if (gameState.insightPoints < seed.cost && !gameState.unlockedSeeds.includes(seedId)) {
                showNotification("Not enough IP!", `You need ${seed.cost} IP to unlock this seed.`);
                return;
            }

            if (!gameState.unlockedSeeds.includes(seedId)) {
                gameState.insightPoints -= seed.cost;
                gameState.unlockedSeeds.push(seedId);
                showNotification("Seed Unlocked!", `You can now plant "${seed.name}".`);
                renderSeedShed();
                renderIP();
            }

            gameState.plantingSeedId = seedId;
            closeModal('seedShedModal', false); // Pass false to indicate this is not a cancellation
            showNotification('Select a Plot', 'Click on an empty garden plot to plant your seed.');
            document.body.style.cursor = 'url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'48\' viewport=\'0 0 100 100\' style=\'fill:black;font-size:24px;\'><text y=\'50%\'>ðŸŒ±</text></svg>") 16 0, auto';
        }

        function openQuestionCrafter(plotId) {
            gameState.activePlotId = plotId;
            const plot = gameState.plots.find(p => p.id === plotId);
            const seed = SEED_DATA[plot.seedId];

            document.getElementById('qc-topic-name').textContent = seed.name;

            const stemSelect = document.getElementById('qc-stem');
            const concept1Select = document.getElementById('qc-concept1');
            const connectorSelect = document.getElementById('qc-connector');
            const stakeholderSelect = document.getElementById('qc-stakeholder');

            stemSelect.innerHTML = seed.stems.map(o => `<option value="${o.value}" data-quality="${o.quality}">${o.text}</option>`).join('');
            concept1Select.innerHTML = seed.concepts.map(o => `<option value="${o.value}" data-quality="${o.quality}">${o.text}</option>`).join('');
            connectorSelect.innerHTML = CONNECTING_PHRASES.map(o => `<option value="${o.value}" data-quality="${o.quality}">${o.text}</option>`).join('');
            // The last dropdown can be from stakeholders OR concepts for more variety
            const lastOptions = [...seed.stakeholders, ...seed.concepts];
            stakeholderSelect.innerHTML = lastOptions.map(o => `<option value="${o.value}" data-quality="${o.quality}">${o.text}</option>`).join('');
            
            openModal('questionCrafterModal');
        }

        function submitQuestion() {
            const plot = gameState.plots.find(p => p.id === gameState.activePlotId);
            if (!plot) return;

            const stemSelect = document.getElementById('qc-stem');
            const concept1Select = document.getElementById('qc-concept1');
            const connectorSelect = document.getElementById('qc-connector');
            const stakeholderSelect = document.getElementById('qc-stakeholder');

            const stemValue = parseInt(stemSelect.value);
            const concept1Value = parseInt(concept1Select.value);
            const connectorValue = parseInt(connectorSelect.value);
            const stakeholderValue = parseInt(stakeholderSelect.value);

            const stemQuality = stemSelect.options[stemSelect.selectedIndex].dataset.quality;

            const score = stemValue + concept1Value + connectorValue + stakeholderValue;
            const ipGained = score * 2;

            plot.growth += score;
            gameState.insightPoints += ipGained;

            let feedbackTitle = '';
            let feedbackMessage = '';

            // Generate smarter feedback
            if (score > 30) {
                feedbackTitle = 'Exceptional Inquiry!';
                feedbackMessage = `This is a highly complex question that connects multiple deep concepts. Fantastic work! (+${ipGained} IP)`;
            } else if (score > 15) {
                feedbackTitle = 'Good Question!';
                feedbackMessage = `You're creating strong connections between different ideas. Keep exploring these links. (+${ipGained} IP)`;
            } else {
                feedbackTitle = 'A Simple Start';
                if (stemQuality === 'basic') {
                     feedbackMessage = `This question is a good starting point for facts. Try using a "How" or "To what extent" stem to explore deeper relationships. (+${ipGained} IP)`;
                } else {
                     feedbackMessage = `A solid start. Try combining a more complex concept or stakeholder to see how it changes the question. (+${ipGained} IP)`;
                }
            }
            
            showNotification(feedbackTitle, feedbackMessage);
            closeModal('questionCrafterModal');
            renderAll();
        }

        function harvestPlant(plotId) {
            const plot = gameState.plots.find(p => p.id === plotId);
            if (!plot || !plot.seedId) return;

            const seed = SEED_DATA[plot.seedId];
            if (plot.growth >= seed.maxGrowth) {
                gameState.insightPoints += seed.harvestBonus;
                showNotification('Harvest!', `You gained ${seed.harvestBonus} Insight Points!`);
                
                // Reset plot
                plot.seedId = null;
                plot.growth = 0;
                
                renderAll();
            }
        }
        
        function buyAlmanacItem(itemId) {
            const item = ALMANAC_DATA.find(i => i.id === itemId);
            if (item && gameState.insightPoints >= item.cost && !gameState.unlockedAlmanacItems.includes(itemId)) {
                gameState.insightPoints -= item.cost;
                gameState.unlockedAlmanacItems.push(itemId);

                if (item.type === 'plot') {
                    gameState.plots.push({ id: gameState.plots.length + 1, seedId: null, growth: 0 });
                }
                
                showNotification('Item Unlocked!', `You have purchased: ${item.name}.`);
                renderAll();
            }
        }
        
        // --- MODAL & UI HELPERS ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                modal.querySelector('.modal-content').classList.remove('scale-95');
                modal.querySelector('.modal-content').classList.add('scale-100');
            }, 10);
        }

        function closeModal(modalId, isCancel = true) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('opacity-100');
            modal.querySelector('.modal-content').classList.add('scale-95');
            modal.querySelector('.modal-content').classList.remove('scale-100');
            setTimeout(() => modal.classList.add('hidden'), 300);
            
            // Only reset planting state if the modal close is a cancel action
            if (isCancel && gameState.plantingSeedId) {
                 gameState.plantingSeedId = null;
                 document.body.style.cursor = 'default';
            }
        }
        
        let notificationTimeout;
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            
            clearTimeout(notificationTimeout);
            
            notification.classList.add('show');
            notificationTimeout = setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
            showNotification('Welcome to Inquiry Garden!', 'Click the Seed Shed to begin your journey.');
        });
    </script>

</body>
</html>

