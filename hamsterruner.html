<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamster Librarian: Bibliography Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #f0e8d9; /* Light parchment color */
            overflow: hidden;
            touch-action: none;
        }

        .game-world {
            position: relative;
            width: 100%;
            height: 100vh;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23c19a6b"/><g fill="%23a47d53"><rect width="100" height="1" y="20"/><rect width="100" height="1" y="40"/><rect width="100" height="1" y="60"/><rect width="100" height="1" y="80"/></g></svg>');
            background-size: 500px;
            animation: scroll-bg 60s linear infinite;
        }

        @keyframes scroll-bg {
            0% { background-position: 0 0; }
            100% { background-position: -1000px 0; }
        }

        .bookshelf {
            position: absolute;
            bottom: 25%;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #8B4513; /* SaddleBrown */
            border-top: 5px solid #654321;
            border-bottom: 5px solid #654321;
        }

        .hamster-container {
            position: absolute;
            bottom: 25%;
            left: 5%;
            width: 150px;
            height: 150px;
            transition: transform 1s ease-in-out;
            transform: translateX(0px);
        }

        .hamster-wheel {
            width: 100%;
            height: 100%;
        }

        .hamster-wheel.spinning #wheel {
            animation: spin 0.5s linear infinite;
            transform-origin: 50% 50%;
        }

        .hamster-wheel.spinning #hamster-body {
            animation: run-body 0.25s linear infinite;
        }

        .hamster-wheel.spinning #foot-front {
            animation: run-foot-front 0.25s linear infinite;
        }
        
        .hamster-wheel.spinning #foot-back {
            animation: run-foot-back 0.25s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes run-body {
            0% { transform: translateY(0px); }
            50% { transform: translateY(2px); }
            100% { transform: translateY(0px); }
        }

        @keyframes run-foot-front {
            0% { transform: translateX(0px); }
            50% { transform: translateX(10px); }
            100% { transform: translateX(0px); }
        }
        @keyframes run-foot-back {
            0% { transform: translateX(0px); }
            50% { transform: translateX(-10px); }
            100% { transform: translateX(0px); }
        }

        .card {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .answer-btn, .lang-btn {
            transition: all 0.2s ease;
        }

        .answer-btn:hover, .lang-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .answer-btn:active, .lang-btn:active {
            transform: translateY(-1px);
        }

        #goal-shelf {
            position: absolute;
            right: -200px; /* Initially off-screen */
            bottom: 25%;
            width: 250px;
            height: 200px;
            transition: transform 1s ease-in-out;
        }

        #goal-shelf.visible {
            transform: translateX(-300px);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
    </style>
</head>
<body class="select-none">

    <div id="game-container" class="w-full h-screen overflow-hidden">
        
        <!-- Game World -->
        <div class="game-world">
            <div class="bookshelf"></div>

            <!-- Goal Shelf -->
            <div id="goal-shelf">
                <svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="120" width="200" height="20" fill="#654321" rx="5"/>
                    <text x="100" y="110" font-family="Lexend, sans-serif" font-size="14" fill="#FFD700" text-anchor="middle" font-weight="bold" data-key="shelfOfKnowledge">Shelf of Knowledge</text>
                    <g transform="translate(10, 20)">
                        <rect x="0" y="0" width="30" height="100" fill="#3A5FCD" rx="2"/>
                        <rect x="35" y="10" width="30" height="90" fill="#B22222" rx="2"/>
                        <rect x="70" y="5" width="30" height="95" fill="#228B22" rx="2"/>
                        <rect x="105" y="20" width="30" height="80" fill="#FFD700" rx="2"/>
                        <rect x="140" y="0" width="30" height="100" fill="#8A2BE2" rx="2"/>
                    </g>
                </svg>
            </div>

            <!-- Hamster -->
            <div id="hamster" class="hamster-container">
                <svg class="hamster-wheel" id="hamster-wheel-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Wheel Group -->
                    <g id="wheel">
                        <circle cx="50" cy="50" r="48" fill="none" stroke="#A0522D" stroke-width="4"/>
                        <line x1="50" y1="2" x2="50" y2="98" stroke="#A0522D" stroke-width="2"/>
                        <line x1="2" y1="50" x2="98" y2="50" stroke="#A0522D" stroke-width="2"/>
                        <line x1="15.9" y1="15.9" x2="84.1" y2="84.1" stroke="#A0522D" stroke-width="2"/>
                        <line x1="15.9" y1="84.1" x2="84.1" y2="15.9" stroke="#A0522D" stroke-width="2"/>
                    </g>
                    <!-- Hamster Group -->
                    <g id="hamster-body" style="transform-origin: center;">
                        <!-- Feet -->
                        <ellipse id="foot-back" cx="45" cy="84" rx="6" ry="3" fill="#C19A6B"/>
                        <ellipse id="foot-front" cx="68" cy="84" rx="6" ry="3" fill="#C19A6B"/>
                        <!-- Tail -->
                        <path d="M 30,68 C 25,65 25,75 30,72" fill="#D2B48C" stroke="#A0522D" stroke-width="0.5"/>
                        <!-- Body -->
                        <path d="M 35,70 C 30,50 50,40 70,50 C 85,55 85,75 70,80 C 50,85 40,85 35,70" fill="#D2B48C"/>
                        <!-- Head details -->
                        <circle cx="72" cy="60" r="2.5" fill="black"/>
                        <!-- Ear -->
                        <path d="M 65,45 C 60,40 70,40 68,50" fill="#FFC0CB" stroke="black" stroke-width="0.5"/>
                    </g>
                </svg>
            </div>
        </div>

        <!-- UI -->
        <div id="ui-container" class="absolute top-0 left-0 w-full h-full p-4 md:p-8 flex flex-col items-center pointer-events-none">
            <div class="w-full max-w-4xl mx-auto pointer-events-auto">
                <div class="card rounded-xl shadow-lg p-4 mb-4 text-center">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800" data-key="gameTitle">Hamster Librarian</h1>
                    <p class="text-gray-600" data-key="gameSubtitle">Help the hamster reach the "Bibliography Shelf of Knowledge"!</p>
                </div>
                
                <div id="question-card" class="card rounded-xl shadow-lg p-6 text-center hidden">
                    <p class="text-lg md:text-xl font-semibold text-gray-700 mb-2" id="question-text"></p>
                    <div class="bg-gray-100 rounded-lg p-4 my-4">
                        <code class="text-base md:text-lg text-indigo-800" id="citation-text"></code>
                    </div>
                    <div id="answers-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
                        <!-- Answer buttons will be injected here -->
                    </div>
                    <div id="feedback-text" class="mt-4 h-6 text-lg font-bold"></div>
                </div>
            </div>
        </div>

        <!-- Language Modal -->
        <div id="language-modal" class="modal-overlay">
            <div class="bg-white rounded-xl shadow-2xl p-8 text-center max-w-md w-full mx-4">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Choose a Language</h2>
                <p class="text-gray-500 mb-6">Select your preferred language to start.</p>
                <div class="flex flex-col space-y-4">
                    <button class="lang-btn bg-blue-500 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-md" onclick="setLanguage('en')">English</button>
                    <button class="lang-btn bg-red-500 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-md" onclick="setLanguage('tr')">Türkçe (Turkish)</button>
                    <button class="lang-btn bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-md" onclick="setLanguage('zh')">中文 (Chinese)</button>
                </div>
            </div>
        </div>

        <!-- Start Modal -->
        <div id="start-modal" class="modal-overlay hidden">
            <div class="bg-white rounded-xl shadow-2xl p-8 text-center max-w-md w-full mx-4">
                <h2 class="text-3xl font-bold text-gray-800 mb-4" data-key="welcomeTitle">Welcome to Hamster Librarian!</h2>
                <p class="text-gray-600 mb-6" data-key="welcomeDesc">Your goal is to help the hamster librarian race across the bookshelves. To move his wheel, you must find the missing part in each bibliography citation.</p>
                <button id="start-btn" class="answer-btn bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-md" data-key="startGame">Start Game</button>
            </div>
        </div>

        <!-- Win Modal -->
        <div id="win-modal" class="modal-overlay hidden">
            <div class="bg-white rounded-xl shadow-2xl p-8 text-center max-w-md w-full mx-4">
                <div class="text-6xl mb-4">🏆</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4" data-key="winTitle">You did it!</h2>
                <p class="text-gray-600 mb-6" data-key="winDesc">The hamster reached the Bibliography Shelf of Knowledge! You're a citation expert. You answered <span id="final-score"></span> questions correctly.</p>
                <button id="play-again-btn" class="answer-btn bg-blue-500 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-md" data-key="playAgain">Play Again</button>
            </div>
        </div>

    </div>

    <script>
        // Game elements
        const hamster = document.getElementById('hamster');
        const hamsterWheelSvg = document.getElementById('hamster-wheel-svg');
        const questionCard = document.getElementById('question-card');
        const questionText = document.getElementById('question-text');
        const citationText = document.getElementById('citation-text');
        const answersContainer = document.getElementById('answers-container');
        const feedbackText = document.getElementById('feedback-text');
        const goalShelf = document.getElementById('goal-shelf');

        // Modals
        const languageModal = document.getElementById('language-modal');
        const startModal = document.getElementById('start-modal');
        const winModal = document.getElementById('win-modal');
        const startBtn = document.getElementById('start-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const finalScoreEl = document.getElementById('final-score');
        
        // --- TRANSLATIONS ---
        const translations = {
            en: {
                // UI
                gameTitle: "Hamster Librarian",
                gameSubtitle: 'Help the hamster reach the "Bibliography Shelf of Knowledge"!',
                shelfOfKnowledge: "Shelf of Knowledge",
                welcomeTitle: "Welcome to Hamster Librarian!",
                welcomeDesc: "Your goal is to help the hamster librarian race across the bookshelves. To move his wheel, you must find the missing part in each bibliography citation.",
                startGame: "Start Game",
                winTitle: "You did it!",
                winDesc: "The hamster reached the Bibliography Shelf of Knowledge! You're a citation expert. You answered",
                playAgain: "Play Again",
                correctFeedback: "Correct! Go hamster, go!",
                incorrectFeedback: "Not quite! The missing part was",
                // Options
                author: "Author",
                year: "Year",
                url: "URL",
                publisher: "Publisher",
                title: "Title",
                authororganization: "Author/Organization",
                pages: "Pages",
                illustrator: "Illustrator",
                editor: "Editor",
                volume: "Volume",
                chapter: "Chapter",
                nasa: "NASA",
                unicef: "UNICEF",
                google: "Google",
                mojangstudios: "Mojang Studios",
                microsoft: "Microsoft",
                nintendo: "Nintendo",
                thegiver: "<i>The Giver</i>",
                thehungergames: "<i>The Hunger Games</i>",
                holes: "<i>Holes</i>",
                mauricesendak: "Maurice Sendak",
                drseuss: "Dr. Seuss",
                ericcarle: "Eric Carle",
                pbskids: "PBS Kids",
                nickelodeon: "Nickelodeon",
                disney: "Disney",
                jrrtolkien: "J.R.R. Tolkien",
                cslewis: "C.S. Lewis",
                georgerrmartin: "George R.R. Martin",
                awrinkleintime: "<i>A Wrinkle in Time</i>",
                thephantomtollbooth: "<i>The Phantom Tollbooth</i>",
                historycom: "History.com",
                thehistorychannel: "The History Channel",
                nationalgeographic: "National Geographic",
            },
            tr: {
                // UI
                gameTitle: "Hamster Kütüphaneci",
                gameSubtitle: 'Hamsterın "Bilgi Bibliyografya Rafı"na ulaşmasına yardım et!',
                shelfOfKnowledge: "Bilgi Rafı",
                welcomeTitle: "Hamster Kütüphaneci'ye Hoş Geldiniz!",
                welcomeDesc: "Amacınız, hamster kütüphanecinin kitap rafları arasında yarışmasına yardım etmektir. Tekerleğini hareket ettirmek için her kaynakça alıntısındaki eksik kısmı bulmalısınız.",
                startGame: "Oyuna Başla",
                winTitle: "Başardın!",
                winDesc: "Hamster, Bilgi Bibliyografya Rafı'na ulaştı! Sen bir alıntı uzmanısın. Cevapladığın doğru soru sayısı:",
                playAgain: "Tekrar Oyna",
                correctFeedback: "Doğru! Git hamster, git!",
                incorrectFeedback: "Tam değil! Eksik kısım şuydu:",
                // Options
                author: "Yazar",
                year: "Yıl",
                url: "URL",
                publisher: "Yayıncı",
                title: "Başlık",
                authororganization: "Yazar/Kuruluş",
                pages: "Sayfalar",
                illustrator: "Çizer",
                editor: "Editör",
                volume: "Cilt",
                chapter: "Bölüm",
                nasa: "NASA",
                unicef: "UNICEF",
                google: "Google",
                mojangstudios: "Mojang Studios",
                microsoft: "Microsoft",
                nintendo: "Nintendo",
                thegiver: "<i>Seçilmiş Kişi</i>",
                thehungergames: "<i>Açlık Oyunları</i>",
                holes: "<i>Kuyucuklar</i>",
                mauricesendak: "Maurice Sendak",
                drseuss: "Dr. Seuss",
                ericcarle: "Eric Carle",
                pbskids: "PBS Kids",
                nickelodeon: "Nickelodeon",
                disney: "Disney",
                jrrtolkien: "J.R.R. Tolkien",
                cslewis: "C.S. Lewis",
                georgerrmartin: "George R.R. Martin",
                awrinkleintime: "<i>Zamanda Kıvrılma</i>",
                thephantomtollbooth: "<i>Harikalar Diyarı Gişesi</i>",
                historycom: "History.com",
                thehistorychannel: "The History Channel",
                nationalgeographic: "National Geographic",
            },
            zh: {
                // UI
                gameTitle: "仓鼠图书馆员",
                gameSubtitle: "帮助仓鼠到达“知识书目架”！",
                shelfOfKnowledge: "知识之架",
                welcomeTitle: "欢迎来到仓鼠图书馆员！",
                welcomeDesc: "你的目标是帮助仓鼠图书馆员跑过书架。要让它的轮子转动，你必须在每个书目引文中找到缺失的部分。",
                startGame: "开始游戏",
                winTitle: "你成功了！",
                winDesc: "仓鼠到达了知识书目架！你是一位引文专家。你答对了",
                playAgain: "再玩一次",
                correctFeedback: "正确！加油，仓鼠！",
                incorrectFeedback: "不对哦！缺失的部分是",
                // Options
                author: "作者",
                year: "年份",
                url: "网址",
                publisher: "出版商",
                title: "标题",
                authororganization: "作者/组织",
                pages: "页数",
                illustrator: "插画师",
                editor: "编辑",
                volume: "卷",
                chapter: "章节",
                nasa: "美国国家航空航天局",
                unicef: "联合国儿童基金会",
                google: "谷歌",
                mojangstudios: "Mojang Studios",
                microsoft: "微软",
                nintendo: "任天堂",
                thegiver: "<i>记忆传授人</i>",
                thehungergames: "<i>饥饿游戏</i>",
                holes: "<i>洞</i>",
                mauricesendak: "莫里斯·桑达克",
                drseuss: "苏斯博士",
                ericcarle: "艾瑞·卡尔",
                pbskids: "PBS Kids",
                nickelodeon: "尼克儿童频道",
                disney: "迪士尼",
                jrrtolkien: "J.R.R. 托尔金",
                cslewis: "C.S. 刘易斯",
                georgerrmartin: "乔治·R·R·马丁",
                awrinkleintime: "<i>时间的皱折</i>",
                thephantomtollbooth: "<i>神奇的收费亭</i>",
                historycom: "History.com",
                thehistorychannel: "历史频道",
                nationalgeographic: "国家地理",
            }
        };

        const createQuestions = (lang) => {
            const t = translations[lang];
            return [
                { citation: '<i>Global Issues Today</i>. 2019.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Author', 'Year', 'URL'], answer: 'Author' },
                { citation: 'Smith, John. <i>Global Issues Today</i>.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Publisher', 'Year', 'Title'], answer: 'Year' },
                { citation: 'UNICEF. "Children and Education." https://www.unicef.org/education', question: (lang === 'zh' ? "这个网站的引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What's missing from this website citation?")), options: ['Author', 'Title', 'Year'], answer: 'Year' },
                { citation: 'World Health Organization. "COVID-19 pandemic." 2023.', question: (lang === 'zh' ? "这个网站的引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What's missing from this website citation?")), options: ['URL', 'Author', 'Title'], answer: 'URL' },
                { citation: 'Rowling, J.K. 1997.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Title', 'Publisher', 'Author'], answer: 'Title' },
                { citation: '"How to Build a Treehouse." 2021. https://www.diynetwork.com/how-to/treehouse', question: (lang === 'zh' ? "这个网站的引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What's missing from this website citation?")), options: ['Year', 'Author/Organization', 'URL'], answer: 'Author/Organization' },
                { citation: 'Green, John. <i>The Fault in Our Stars</i>.', question: (lang === 'zh' ? "这本书缺少了哪个关键信息？" : (lang === 'tr' ? "Bu kitap için hangi önemli bilgi eksik?" : "What key piece of information is missing for this book?")), options: ['Year', 'Pages', 'Illustrator'], answer: 'Year' },
                { citation: 'National Geographic. "Planet Earth." 2024.', question: (lang === 'zh' ? "你需要添加什么才能在线访问这个来源？" : (lang === 'tr' ? "Bu kaynağı çevrimiçi ziyaret etmek için ne eklemeniz gerekir?" : "What would you need to add to visit this source online?")), options: ['Editor', 'URL', 'Volume'], answer: 'URL' },
                { citation: '<i>The Hunger Games</i>. 2008.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Author', 'Publisher', 'Chapter'], answer: 'Author' },
                { citation: 'Dahl, Roald. <i>Charlie and the Chocolate Factory</i>.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Year', 'Illustrator', 'Author'], answer: 'Year' },
                { citation: '"Climate Change." 2024. https://www.nasa.gov/climate', question: (lang === 'zh' ? "哪个组织发布了这个网站来源？" : (lang === 'tr' ? "Bu web sitesi kaynağını hangi kuruluş yayınladı?" : "What organization published this website source?")), options: ['NASA', 'UNICEF', 'Google'], answer: 'NASA' },
                { citation: 'Google. "How Search Works." https://www.google.com/search/howsearchworks/', question: (lang === 'zh' ? "这个网站的引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What's missing from this website citation?")), options: ['Year', 'Title', 'Author'], answer: 'Year' },
                { citation: '<i>Diary of a Wimpy Kid</i>. 2007.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Author', 'Publisher', 'Title'], answer: 'Author' },
                { citation: 'American Red Cross. 2024. https://www.redcross.org/get-help', question: (lang === 'zh' ? "这个网站的引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What's missing from this website citation?")), options: ['Title', 'URL', 'Year'], answer: 'Title' },
                { citation: 'Riordan, Rick. <i>The Lightning Thief</i>.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Year', 'Editor', 'Author'], answer: 'Year' },
                { citation: '"Minecraft Guide." 2024. https://www.minecraft.net/en-us/guide', question: (lang === 'zh' ? "这个网站引文缺少了哪个组织？" : (lang === 'tr' ? "Bu web sitesi alıntısında hangi kuruluş eksik?" : "What organization is missing from this website citation?")), options: ['Mojang Studios', 'Microsoft', 'Nintendo'], answer: 'Mojang Studios' },
                { citation: '<i>Bridge to Terabithia</i>. 1977.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What's missing from this book citation?")), options: ['Author', 'Year', 'Publisher'], answer: 'Author' },
                { citation: 'The World Bank. "Our Mission." 2024.', question: (lang === 'zh' ? "这个网站引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısı ne eksik?" : "What is this website citation missing?")), options: ['URL', 'Title', 'Author'], answer: 'URL' },
                { citation: 'Lowry, Lois. 1993.', question: (lang === 'zh' ? "这个引文缺少了哪本书的标题？" : (lang === 'tr' ? "Bu alıntıda hangi kitap başlığı eksik?" : "What book title is missing from this citation?")), options: ['<i>The Giver</i>', '<i>The Hunger Games</i>', '<i>Holes</i>'], answer: '<i>The Giver</i>' },
                { citation: 'Khan Academy. "Intro to Algebra." https://www.khanacademy.org/math/algebra', question: (lang === 'zh' ? "这个网站引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısı ne eksik?" : "What is this website citation missing?")), options: ['Year', 'Title', 'URL'], answer: 'Year' },
                { citation: '<i>Where the Wild Things Are</i>. 1963.', question: (lang === 'zh' ? "这本书的作者是谁？" : (lang === 'tr' ? "Bu kitabın yazarı kim?" : "Who is the author of this book?")), options: ['Maurice Sendak', 'Dr. Seuss', 'Eric Carle'], answer: 'Maurice Sendak' },
                { citation: 'Scholastic. "Harry Potter." 2024.', question: (lang === 'zh' ? "这个网站引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısı ne eksik?" : "What is this website citation missing?")), options: ['URL', 'Author', 'Title'], answer: 'URL' },
                { citation: 'Lewis, C.S. <i>The Lion, the Witch and the Wardrobe</i>.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What is this book citation missing?")), options: ['Year', 'Publisher', 'Author'], answer: 'Year' },
                { citation: '"How to Make Slime." 2023. https://www.pbs.org/parents/crafts-and-experiments/how-to-make-slime', question: (lang === 'zh' ? "缺少了哪个组织？" : (lang === 'tr' ? "Hangi kuruluş eksik?" : "What organization is missing?")), options: ['PBS Kids', 'Nickelodeon', 'Disney'], answer: 'PBS Kids' },
                { citation: '<i>The Hobbit</i>. 1937.', question: (lang === 'zh' ? "这本书的作者是谁？" : (lang === 'tr' ? "Bu kitabın yazarı kim?" : "Who is the author of this book?")), options: ['J.R.R. Tolkien', 'C.S. Lewis', 'George R.R. Martin'], answer: 'J.R.R. Tolkien' },
                { citation: 'Doctors Without Borders. "Our Work." 2024.', question: (lang === 'zh' ? "这个网站引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What is missing from this website citation?")), options: ['URL', 'Author', 'Year'], answer: 'URL' },
                { citation: 'L\'Engle, Madeleine. 1962.', question: (lang === 'zh' ? "这本书的标题是什么？" : (lang === 'tr' ? "Bu kitabın başlığı nedir?" : "What is the title of this book?")), options: ['<i>A Wrinkle in Time</i>', '<i>The Giver</i>', '<i>The Phantom Tollbooth</i>'], answer: '<i>A Wrinkle in Time</i>' },
                { citation: 'BrainPOP. "Photosynthesis." https://www.brainpop.com/science/cellularlifeandgenetics/photosynthesis/', question: (lang === 'zh' ? "这个网站引文缺少了什么？" : (lang === 'tr' ? "Bu web sitesi alıntısında ne eksik?" : "What is missing from this website citation?")), options: ['Year', 'URL', 'Title'], answer: 'Year' },
                { citation: '"History of Ancient Rome." 2023. https://www.history.com/topics/ancient-rome/ancient-rome', question: (lang === 'zh' ? "这个网站引文缺少了哪个组织？" : (lang === 'tr' ? "Bu web sitesi alıntısında hangi kuruluş eksik?" : "What organization is missing from this website citation?")), options: ['History.com', 'The History Channel', 'National Geographic'], answer: 'History.com' },
                { citation: 'Spinney, Caroll. <i>The Wisdom of Big Bird</i>.', question: (lang === 'zh' ? "这本书的引文缺少了什么？" : (lang === 'tr' ? "Bu kitap alıntısında ne eksik?" : "What is missing from this book citation?")), options: ['Year', 'Title', 'Author'], answer: 'Year' },
            ];
        }
        
        // Game state
        let currentLanguage = 'en';
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let gameInProgress = false;
        let currentRoundQuestions = [];
        const QUESTIONS_PER_ROUND = 8;
        
        function setLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (t[key]) {
                    el.innerHTML = t[key];
                }
            });

            languageModal.classList.add('hidden');
            startModal.classList.remove('hidden');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            startModal.classList.add('hidden');
            winModal.classList.add('hidden');
            questionCard.classList.remove('hidden');
            
            currentQuestionIndex = 0;
            correctAnswers = 0;
            gameInProgress = true;
            
            let questions = createQuestions(currentLanguage);
            shuffleArray(questions);
            currentRoundQuestions = questions.slice(0, QUESTIONS_PER_ROUND);

            updateHamsterPosition();
            displayQuestion();
            
            setTimeout(() => {
                goalShelf.classList.add('visible');
            }, 500);
        }

        function displayQuestion() {
            if (currentQuestionIndex >= currentRoundQuestions.length) {
                winGame();
                return;
            }

            const currentQuestion = currentRoundQuestions[currentQuestionIndex];
            questionText.textContent = currentQuestion.question;
            citationText.innerHTML = currentQuestion.citation;
            
            answersContainer.innerHTML = '';
            feedbackText.textContent = '';
            
            const shuffledOptions = [...currentQuestion.options];
            shuffleArray(shuffledOptions);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                // Use a simplified key for translation lookup
                const optionKey = option.toLowerCase().replace(/[^a-z0-9]/gi, '');
                button.innerHTML = translations[currentLanguage][optionKey] || option;
                button.classList.add('answer-btn', 'bg-blue-500', 'hover:bg-blue-600', 'text-white', 'font-bold', 'py-3', 'px-4', 'rounded-lg', 'w-full');
                button.onclick = () => checkAnswer(option);
                answersContainer.appendChild(button);
            });
        }

        function checkAnswer(selectedOption) {
            if (!gameInProgress) return;

            const currentQuestion = currentRoundQuestions[currentQuestionIndex];
            const isCorrect = selectedOption === currentQuestion.answer;
            
            Array.from(answersContainer.children).forEach(btn => btn.disabled = true);

            if (isCorrect) {
                feedbackText.textContent = translations[currentLanguage].correctFeedback;
                feedbackText.classList.add('text-green-600');
                feedbackText.classList.remove('text-red-600');
                correctAnswers++;
                updateHamsterPosition();
                hamsterWheelSvg.classList.add('spinning');
            } else {
                const answerKey = currentQuestion.answer.toLowerCase().replace(/[^a-z0-9]/gi, '');
                const translatedAnswer = translations[currentLanguage][answerKey] || currentQuestion.answer;
                feedbackText.innerHTML = `${translations[currentLanguage].incorrectFeedback} "${translatedAnswer}".`;
                feedbackText.classList.remove('text-green-600');
                feedbackText.classList.add('text-red-600');
            }
            
            currentQuestionIndex++;
            
            setTimeout(() => {
                hamsterWheelSvg.classList.remove('spinning');
                displayQuestion();
                Array.from(answersContainer.children).forEach(btn => btn.disabled = false);
            }, 2000);
        }

        function updateHamsterPosition() {
            const gameWidth = document.body.clientWidth;
            const hamsterWidth = hamster.offsetWidth;
            const endPosition = gameWidth * 0.8 - hamsterWidth;
            const startPosition = gameWidth * 0.05;

            const progress = correctAnswers / QUESTIONS_PER_ROUND;
            const newPosition = startPosition + (endPosition - startPosition) * progress;

            hamster.style.transform = `translateX(${newPosition}px)`;
        }

        function winGame() {
            gameInProgress = false;
            questionCard.classList.add('hidden');
            winModal.classList.remove('hidden');
            const winDesc = translations[currentLanguage].winDesc;
            finalScoreEl.parentElement.innerHTML = `${winDesc} <span id="final-score">${correctAnswers}</span> / ${QUESTIONS_PER_ROUND}.`;
            goalShelf.classList.remove('visible');
        }

        // Event Listeners
        startBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', () => {
             winModal.classList.add('hidden');
             languageModal.classList.remove('hidden');
        });
        window.addEventListener('resize', updateHamsterPosition);

    </script>
</body>
</html>

